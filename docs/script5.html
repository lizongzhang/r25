<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.551">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Li Zongzhang">
<meta name="dcterms.date" content="2025-03-17">

<title>R语言与统计应用25春 - 第5讲 tidyverse</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script>
  document.querySelectorAll('a').forEach(function(link) {
    link.setAttribute('target', '_blank');
  });
</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">R语言与统计应用25春</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./L1.html"> 
<span class="menu-text">第1讲</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./L2.html"> 
<span class="menu-text">第2讲</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./L3.html"> 
<span class="menu-text">第3讲</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./L4.html"> 
<span class="menu-text">第4讲</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./L5.html"> 
<span class="menu-text">第5讲</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./L6.html"> 
<span class="menu-text">第6讲</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./L7.html"> 
<span class="menu-text">第7讲</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./L8.html"> 
<span class="menu-text">第8讲</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./L9.html"> 
<span class="menu-text">第9讲</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./L10.html"> 
<span class="menu-text">第10讲</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./L11.html"> 
<span class="menu-text">第11讲</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
    <a href="./lizongzhang9@qq.com" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-envelope"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#什么是tidy-data" id="toc-什么是tidy-data" class="nav-link active" data-scroll-target="#什么是tidy-data"><span class="header-section-number">1</span> 什么是tidy data？</a></li>
  <li><a href="#如何查看数据" id="toc-如何查看数据" class="nav-link" data-scroll-target="#如何查看数据"><span class="header-section-number">2</span> 如何查看数据？</a></li>
  <li><a href="#dplyr函数" id="toc-dplyr函数" class="nav-link" data-scroll-target="#dplyr函数"><span class="header-section-number">3</span> dplyr函数</a>
  <ul class="collapse">
  <li><a href="#dplyr函数的共性" id="toc-dplyr函数的共性" class="nav-link" data-scroll-target="#dplyr函数的共性"><span class="header-section-number">3.1</span> dplyr函数的共性</a></li>
  <li><a href="#dplyr函数的分类" id="toc-dplyr函数的分类" class="nav-link" data-scroll-target="#dplyr函数的分类"><span class="header-section-number">3.2</span> dplyr函数的分类</a></li>
  <li><a href="#rows" id="toc-rows" class="nav-link" data-scroll-target="#rows"><span class="header-section-number">3.3</span> Rows</a>
  <ul class="collapse">
  <li><a href="#保留filter" id="toc-保留filter" class="nav-link" data-scroll-target="#保留filter"><span class="header-section-number">3.3.1</span> 保留filter()</a></li>
  <li><a href="#排序arange" id="toc-排序arange" class="nav-link" data-scroll-target="#排序arange"><span class="header-section-number">3.3.2</span> 排序arange()</a></li>
  <li><a href="#删除有缺失值的行na.omitdrop_na" id="toc-删除有缺失值的行na.omitdrop_na" class="nav-link" data-scroll-target="#删除有缺失值的行na.omitdrop_na"><span class="header-section-number">3.3.3</span> 删除有缺失值的行na.omit()/drop_na()</a></li>
  <li><a href="#去重distinct" id="toc-去重distinct" class="nav-link" data-scroll-target="#去重distinct"><span class="header-section-number">3.3.4</span> 去重distinct()</a></li>
  <li><a href="#缺失值is.na" id="toc-缺失值is.na" class="nav-link" data-scroll-target="#缺失值is.na"><span class="header-section-number">3.3.5</span> 缺失值is.na()</a></li>
  <li><a href="#小练习" id="toc-小练习" class="nav-link" data-scroll-target="#小练习"><span class="header-section-number">3.3.6</span> 小练习</a></li>
  </ul></li>
  <li><a href="#columns" id="toc-columns" class="nav-link" data-scroll-target="#columns"><span class="header-section-number">3.4</span> Columns</a>
  <ul class="collapse">
  <li><a href="#追加变量mutate" id="toc-追加变量mutate" class="nav-link" data-scroll-target="#追加变量mutate"><span class="header-section-number">3.4.1</span> 追加变量mutate()</a></li>
  <li><a href="#选择变量select" id="toc-选择变量select" class="nav-link" data-scroll-target="#选择变量select"><span class="header-section-number">3.4.2</span> 选择变量select()</a></li>
  <li><a href="#重命名变量rename" id="toc-重命名变量rename" class="nav-link" data-scroll-target="#重命名变量rename"><span class="header-section-number">3.4.3</span> 重命名变量rename()</a></li>
  <li><a href="#二值转换if_else" id="toc-二值转换if_else" class="nav-link" data-scroll-target="#二值转换if_else"><span class="header-section-number">3.4.4</span> 二值转换if_else()</a></li>
  <li><a href="#多值转换case_when" id="toc-多值转换case_when" class="nav-link" data-scroll-target="#多值转换case_when"><span class="header-section-number">3.4.5</span> 多值转换case_when()</a></li>
  <li><a href="#重新编码recode" id="toc-重新编码recode" class="nav-link" data-scroll-target="#重新编码recode"><span class="header-section-number">3.4.6</span> 重新编码recode()</a></li>
  <li><a href="#前置变量relocate" id="toc-前置变量relocate" class="nav-link" data-scroll-target="#前置变量relocate"><span class="header-section-number">3.4.7</span> 前置变量relocate()</a></li>
  <li><a href="#小练习-1" id="toc-小练习-1" class="nav-link" data-scroll-target="#小练习-1"><span class="header-section-number">3.4.8</span> 小练习</a></li>
  </ul></li>
  <li><a href="#the-pipe" id="toc-the-pipe" class="nav-link" data-scroll-target="#the-pipe"><span class="header-section-number">3.5</span> The pipe</a></li>
  <li><a href="#groups" id="toc-groups" class="nav-link" data-scroll-target="#groups"><span class="header-section-number">3.6</span> Groups</a>
  <ul class="collapse">
  <li><a href="#group_by" id="toc-group_by" class="nav-link" data-scroll-target="#group_by"><span class="header-section-number">3.6.1</span> group_by()</a></li>
  <li><a href="#summarize" id="toc-summarize" class="nav-link" data-scroll-target="#summarize"><span class="header-section-number">3.6.2</span> summarize()</a></li>
  <li><a href="#by" id="toc-by" class="nav-link" data-scroll-target="#by"><span class="header-section-number">3.6.3</span> .by</a></li>
  <li><a href="#小练习-2" id="toc-小练习-2" class="nav-link" data-scroll-target="#小练习-2"><span class="header-section-number">3.6.4</span> 小练习</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#forcats函数" id="toc-forcats函数" class="nav-link" data-scroll-target="#forcats函数"><span class="header-section-number">4</span> forcats函数</a>
  <ul class="collapse">
  <li><a href="#fct_recode" id="toc-fct_recode" class="nav-link" data-scroll-target="#fct_recode"><span class="header-section-number">4.1</span> fct_recode()</a></li>
  <li><a href="#fct_infreq-按频数降序" id="toc-fct_infreq-按频数降序" class="nav-link" data-scroll-target="#fct_infreq-按频数降序"><span class="header-section-number">4.2</span> fct_infreq() 按频数降序</a></li>
  <li><a href="#fct_rev" id="toc-fct_rev" class="nav-link" data-scroll-target="#fct_rev"><span class="header-section-number">4.3</span> fct_rev()</a></li>
  <li><a href="#fct_reorder" id="toc-fct_reorder" class="nav-link" data-scroll-target="#fct_reorder"><span class="header-section-number">4.4</span> fct_reorder()</a>
  <ul class="collapse">
  <li><a href="#按中位数升序排列箱线图" id="toc-按中位数升序排列箱线图" class="nav-link" data-scroll-target="#按中位数升序排列箱线图"><span class="header-section-number">4.4.1</span> 按中位数升序排列箱线图</a></li>
  <li><a href="#按中位数降序排列箱线图" id="toc-按中位数降序排列箱线图" class="nav-link" data-scroll-target="#按中位数降序排列箱线图"><span class="header-section-number">4.4.2</span> 按中位数降序排列箱线图</a></li>
  <li><a href="#按平均数排列箱线图" id="toc-按平均数排列箱线图" class="nav-link" data-scroll-target="#按平均数排列箱线图"><span class="header-section-number">4.4.3</span> 按平均数排列箱线图</a></li>
  <li><a href="#柱形的排列" id="toc-柱形的排列" class="nav-link" data-scroll-target="#柱形的排列"><span class="header-section-number">4.4.4</span> 柱形的排列</a></li>
  </ul></li>
  <li><a href="#fct_lump_合并小类" id="toc-fct_lump_合并小类" class="nav-link" data-scroll-target="#fct_lump_合并小类"><span class="header-section-number">4.5</span> fct_lump_()合并小类</a></li>
  <li><a href="#fct_collaps保留指定类别" id="toc-fct_collaps保留指定类别" class="nav-link" data-scroll-target="#fct_collaps保留指定类别"><span class="header-section-number">4.6</span> fct_collaps()保留指定类别</a></li>
  <li><a href="#fct_other" id="toc-fct_other" class="nav-link" data-scroll-target="#fct_other"><span class="header-section-number">4.7</span> fct_other()</a></li>
  <li><a href="#保存合并后的类别" id="toc-保存合并后的类别" class="nav-link" data-scroll-target="#保存合并后的类别"><span class="header-section-number">4.8</span> 保存合并后的类别</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">第5讲 tidyverse</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Li Zongzhang </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 17, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>“Tidy datasets are all alike, but every messy dataset is messy in its own way.” — Hadley Wickham</p>
<p>Ref: <a href="https://r4ds.hadley.nz/">Wickham, H., Çetinkaya-Rundel, M., &amp; Grolemund, G. (2023). R for data science.</a></p>
<p><strong>需要安装和加载的包</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># install.packages("nycflights13")</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="co"># install.packages("tidyverse")</span></span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="fu">library</span>(nycflights13)</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="什么是tidy-data" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> 什么是tidy data？</h1>
<p>对比table1, table2, table3</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>table1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  country      year  cases population
  &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;
1 Afghanistan  1999    745   19987071
2 Afghanistan  2000   2666   20595360
3 Brazil       1999  37737  172006362
4 Brazil       2000  80488  174504898
5 China        1999 212258 1272915272
6 China        2000 213766 1280428583</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>table2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 4
   country      year type            count
   &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;
 1 Afghanistan  1999 cases             745
 2 Afghanistan  1999 population   19987071
 3 Afghanistan  2000 cases            2666
 4 Afghanistan  2000 population   20595360
 5 Brazil       1999 cases           37737
 6 Brazil       1999 population  172006362
 7 Brazil       2000 cases           80488
 8 Brazil       2000 population  174504898
 9 China        1999 cases          212258
10 China        1999 population 1272915272
11 China        2000 cases          213766
12 China        2000 population 1280428583</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>table3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  country      year rate             
  &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;            
1 Afghanistan  1999 745/19987071     
2 Afghanistan  2000 2666/20595360    
3 Brazil       1999 37737/172006362  
4 Brazil       2000 80488/174504898  
5 China        1999 212258/1272915272
6 China        2000 213766/1280428583</code></pre>
</div>
</div>
<p><strong>tidydata的特征</strong></p>
<ul>
<li><p>每个变量是一列；每列是一个变量。</p></li>
<li><p>每个观察结果是一行；每行是一个观察结果。</p></li>
<li><p>每个值是一个单元格；每个单元格是一个单一值。</p></li>
</ul>
<p><img src="https://r4ds.hadley.nz/images/tidy-1.png" class="img-fluid"> 为什么要确保你的数据整洁？</p>
<ul>
<li><p>如果你有一个一致的数据结构，学习与之配合的工具就更容易，因为它们具有底层的统一性。</p></li>
<li><p>将变量放在列中, 发挥R的向量化特性，大多数内置的R函数都是与向量一起工作的。</p></li>
</ul>
</section>
<section id="如何查看数据" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> 如何查看数据？</h1>
<p>View()/glimpse()/head()/tail()</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="fu">library</span>(nycflights13)</span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="fu">data</span>(flights)</span>
<span id="cb8-3"><a href="#cb8-3"></a>flights <span class="co">#查看数据</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      517            515         2      830            819
 2  2013     1     1      533            529         4      850            830
 3  2013     1     1      542            540         2      923            850
 4  2013     1     1      544            545        -1     1004           1022
 5  2013     1     1      554            600        -6      812            837
 6  2013     1     1      554            558        -4      740            728
 7  2013     1     1      555            600        -5      913            854
 8  2013     1     1      557            600        -3      709            723
 9  2013     1     1      557            600        -3      838            846
10  2013     1     1      558            600        -2      753            745
# ℹ 336,766 more rows
# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="fu">View</span>(flights) <span class="co">#在View卡片下查看数据</span></span>
<span id="cb10-2"><a href="#cb10-2"></a></span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="fu">glimpse</span>(flights) <span class="co">#查看数据结构</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 336,776
Columns: 19
$ year           &lt;int&gt; 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2…
$ month          &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
$ day            &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
$ dep_time       &lt;int&gt; 517, 533, 542, 544, 554, 554, 555, 557, 557, 558, 558, …
$ sched_dep_time &lt;int&gt; 515, 529, 540, 545, 600, 558, 600, 600, 600, 600, 600, …
$ dep_delay      &lt;dbl&gt; 2, 4, 2, -1, -6, -4, -5, -3, -3, -2, -2, -2, -2, -2, -1…
$ arr_time       &lt;int&gt; 830, 850, 923, 1004, 812, 740, 913, 709, 838, 753, 849,…
$ sched_arr_time &lt;int&gt; 819, 830, 850, 1022, 837, 728, 854, 723, 846, 745, 851,…
$ arr_delay      &lt;dbl&gt; 11, 20, 33, -18, -25, 12, 19, -14, -8, 8, -2, -3, 7, -1…
$ carrier        &lt;chr&gt; "UA", "UA", "AA", "B6", "DL", "UA", "B6", "EV", "B6", "…
$ flight         &lt;int&gt; 1545, 1714, 1141, 725, 461, 1696, 507, 5708, 79, 301, 4…
$ tailnum        &lt;chr&gt; "N14228", "N24211", "N619AA", "N804JB", "N668DN", "N394…
$ origin         &lt;chr&gt; "EWR", "LGA", "JFK", "JFK", "LGA", "EWR", "EWR", "LGA",…
$ dest           &lt;chr&gt; "IAH", "IAH", "MIA", "BQN", "ATL", "ORD", "FLL", "IAD",…
$ air_time       &lt;dbl&gt; 227, 227, 160, 183, 116, 150, 158, 53, 140, 138, 149, 1…
$ distance       &lt;dbl&gt; 1400, 1416, 1089, 1576, 762, 719, 1065, 229, 944, 733, …
$ hour           &lt;dbl&gt; 5, 5, 5, 5, 6, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 5, 6, 6, 6…
$ minute         &lt;dbl&gt; 15, 29, 40, 45, 0, 58, 0, 0, 0, 0, 0, 0, 0, 0, 0, 59, 0…
$ time_hour      &lt;dttm&gt; 2013-01-01 05:00:00, 2013-01-01 05:00:00, 2013-01-01 0…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="fu">head</span>(flights) <span class="co">#查看前6行</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 19
   year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
  &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
1  2013     1     1      517            515         2      830            819
2  2013     1     1      533            529         4      850            830
3  2013     1     1      542            540         2      923            850
4  2013     1     1      544            545        -1     1004           1022
5  2013     1     1      554            600        -6      812            837
6  2013     1     1      554            558        -4      740            728
# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="fu">tail</span>(flights) <span class="co">#查看后6行</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 19
   year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
  &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
1  2013     9    30       NA           1842        NA       NA           2019
2  2013     9    30       NA           1455        NA       NA           1634
3  2013     9    30       NA           2200        NA       NA           2312
4  2013     9    30       NA           1210        NA       NA           1330
5  2013     9    30       NA           1159        NA       NA           1344
6  2013     9    30       NA            840        NA       NA           1020
# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
<ul>
<li><p>int 整数 integer</p></li>
<li><p>dbl 双精度浮点数 bouble (实数)</p></li>
<li><p>chr 字符串</p></li>
<li><p>dttm 日期时间</p></li>
</ul>
</section>
<section id="dplyr函数" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> dplyr函数</h1>
<section id="dplyr函数的共性" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="dplyr函数的共性"><span class="header-section-number">3.1</span> dplyr函数的共性</h2>
<ul>
<li><p>第1项参数是data frame.</p></li>
<li><p>第2项参数描述动作。</p></li>
<li><p>输出结果是一个新的data frame.</p></li>
</ul>
</section>
<section id="dplyr函数的分类" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="dplyr函数的分类"><span class="header-section-number">3.2</span> dplyr函数的分类</h2>
<ul>
<li>行的管理 Rows:
<ul>
<li><code>filter()</code> chooses rows based on column values.</li>
<li><code>arrange()</code> changes the order of the rows.</li>
<li><code>distinct()</code> removes duplicate rows.</li>
<li><code>na.omit()</code> removes rows with missing values.</li>
<li><code>drop.na()</code> removes rows with missing values.</li>
<li><code>slice()</code> chooses rows based on location.</li>
</ul></li>
<li>列的管理 Columns:
<ul>
<li><code>mutate()</code> changes the values of columns and creates new columns.</li>
<li><code>select()</code> changes whether or not a column is included.</li>
<li><code>rename()</code> changes the name of columns.</li>
<li><code>if_else()</code> changes the values of columns based on a condition.</li>
<li><code>case_when()</code> changes the values of columns based on multiple conditions.</li>
<li><code>recode()</code> changes the values of columns based on a condition.</li>
<li><code>relocate()</code> changes the order of the columns.</li>
</ul></li>
<li>行组的管理Groups of rows:
<ul>
<li><code>summarise()</code> collapses a group into a single row.</li>
<li><code>count()</code></li>
<li><code>top_n()</code></li>
</ul></li>
</ul>
</section>
<section id="rows" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="rows"><span class="header-section-number">3.3</span> Rows</h2>
<section id="保留filter" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="保留filter"><span class="header-section-number">3.3.1</span> 保留filter()</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>flights <span class="sc">%&gt;%</span>  </span>
<span id="cb16-2"><a href="#cb16-2"></a>  <span class="fu">filter</span>(dep_delay <span class="sc">&gt;</span> <span class="dv">120</span>) <span class="co">#保留dep_delay大于120的行</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9,723 × 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      848           1835       853     1001           1950
 2  2013     1     1      957            733       144     1056            853
 3  2013     1     1     1114            900       134     1447           1222
 4  2013     1     1     1540           1338       122     2020           1825
 5  2013     1     1     1815           1325       290     2120           1542
 6  2013     1     1     1842           1422       260     1958           1535
 7  2013     1     1     1856           1645       131     2212           2005
 8  2013     1     1     1934           1725       129     2126           1855
 9  2013     1     1     1938           1703       155     2109           1823
10  2013     1     1     1942           1705       157     2124           1830
# ℹ 9,713 more rows
# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
<ul>
<li><p>&gt;=（大于或等于）</p></li>
<li><p>&lt;（小于）</p></li>
<li><p>&lt;=（小于或等于）</p></li>
<li><p>==（等于）</p></li>
<li><p>!=（不等于）</p></li>
<li><p>&amp; 条件组合，同时成立</p></li>
<li><p>| “或”，至少有一个条件成立</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb18-2"><a href="#cb18-2"></a>  <span class="fu">filter</span>(month <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> day <span class="sc">==</span> <span class="dv">1</span>) <span class="co">#筛选出1月1日的航班</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 842 × 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      517            515         2      830            819
 2  2013     1     1      533            529         4      850            830
 3  2013     1     1      542            540         2      923            850
 4  2013     1     1      544            545        -1     1004           1022
 5  2013     1     1      554            600        -6      812            837
 6  2013     1     1      554            558        -4      740            728
 7  2013     1     1      555            600        -5      913            854
 8  2013     1     1      557            600        -3      709            723
 9  2013     1     1      557            600        -3      838            846
10  2013     1     1      558            600        -2      753            745
# ℹ 832 more rows
# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2"></a>  <span class="fu">filter</span>(month <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span> month <span class="sc">==</span> <span class="dv">2</span>) <span class="co">#筛选出1月或2月的航班</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 51,955 × 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      517            515         2      830            819
 2  2013     1     1      533            529         4      850            830
 3  2013     1     1      542            540         2      923            850
 4  2013     1     1      544            545        -1     1004           1022
 5  2013     1     1      554            600        -6      812            837
 6  2013     1     1      554            558        -4      740            728
 7  2013     1     1      555            600        -5      913            854
 8  2013     1     1      557            600        -3      709            723
 9  2013     1     1      557            600        -3      838            846
10  2013     1     1      558            600        -2      753            745
# ℹ 51,945 more rows
# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb22-2"><a href="#cb22-2"></a>  <span class="fu">filter</span>(month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)) <span class="co">#筛选出1月或2月的航班</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 51,955 × 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      517            515         2      830            819
 2  2013     1     1      533            529         4      850            830
 3  2013     1     1      542            540         2      923            850
 4  2013     1     1      544            545        -1     1004           1022
 5  2013     1     1      554            600        -6      812            837
 6  2013     1     1      554            558        -4      740            728
 7  2013     1     1      555            600        -5      913            854
 8  2013     1     1      557            600        -3      709            723
 9  2013     1     1      557            600        -3      838            846
10  2013     1     1      558            600        -2      753            745
# ℹ 51,945 more rows
# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
<p><strong>注意：当你运行 filter() 时，dplyr 执行过滤操作，创建一个新的数据框，然后打印它。它不会修改现有的 flights 数据集，因为 dplyr 函数永远不会修改它们的输入。要保存结果，你需要使用赋值操作符，&lt;-</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="co">#筛选出1月1日的航班,并保存到flights_jan1</span></span>
<span id="cb24-2"><a href="#cb24-2"></a>flights_jan1 <span class="ot">&lt;-</span> flights <span class="sc">%&gt;%</span> </span>
<span id="cb24-3"><a href="#cb24-3"></a>  <span class="fu">filter</span>(month <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> day <span class="sc">==</span> <span class="dv">1</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>常见错误</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="co"># flights %&gt;% </span></span>
<span id="cb25-2"><a href="#cb25-2"></a><span class="co">#   filter(month = 1) #错误，应该用==而不是=</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="co"># flights %&gt;%</span></span>
<span id="cb26-2"><a href="#cb26-2"></a><span class="co">#    filter(month == 1 | 2)  #错误，应该用month == 1 | month == 2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="排序arange" class="level3" data-number="3.3.2">
<h3 data-number="3.3.2" class="anchored" data-anchor-id="排序arange"><span class="header-section-number">3.3.2</span> 排序arange()</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb27-2"><a href="#cb27-2"></a>  <span class="fu">arrange</span>(year, month, day, dep_time) <span class="co">#按照year, month, day, dep_time排序</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      517            515         2      830            819
 2  2013     1     1      533            529         4      850            830
 3  2013     1     1      542            540         2      923            850
 4  2013     1     1      544            545        -1     1004           1022
 5  2013     1     1      554            600        -6      812            837
 6  2013     1     1      554            558        -4      740            728
 7  2013     1     1      555            600        -5      913            854
 8  2013     1     1      557            600        -3      709            723
 9  2013     1     1      557            600        -3      838            846
10  2013     1     1      558            600        -2      753            745
# ℹ 336,766 more rows
# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb29-2"><a href="#cb29-2"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(dep_delay)) <span class="co">#desc()按照dep_time降序排序</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     9      641            900      1301     1242           1530
 2  2013     6    15     1432           1935      1137     1607           2120
 3  2013     1    10     1121           1635      1126     1239           1810
 4  2013     9    20     1139           1845      1014     1457           2210
 5  2013     7    22      845           1600      1005     1044           1815
 6  2013     4    10     1100           1900       960     1342           2211
 7  2013     3    17     2321            810       911      135           1020
 8  2013     6    27      959           1900       899     1236           2226
 9  2013     7    22     2257            759       898      121           1026
10  2013    12     5      756           1700       896     1058           2020
# ℹ 336,766 more rows
# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
</section>
<section id="删除有缺失值的行na.omitdrop_na" class="level3" data-number="3.3.3">
<h3 data-number="3.3.3" class="anchored" data-anchor-id="删除有缺失值的行na.omitdrop_na"><span class="header-section-number">3.3.3</span> 删除有缺失值的行na.omit()/drop_na()</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb31-2"><a href="#cb31-2"></a>  <span class="fu">na.omit</span>() <span class="co">#删除含有NA的行</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 327,346 × 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      517            515         2      830            819
 2  2013     1     1      533            529         4      850            830
 3  2013     1     1      542            540         2      923            850
 4  2013     1     1      544            545        -1     1004           1022
 5  2013     1     1      554            600        -6      812            837
 6  2013     1     1      554            558        -4      740            728
 7  2013     1     1      555            600        -5      913            854
 8  2013     1     1      557            600        -3      709            723
 9  2013     1     1      557            600        -3      838            846
10  2013     1     1      558            600        -2      753            745
# ℹ 327,336 more rows
# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb33-2"><a href="#cb33-2"></a>  <span class="fu">drop_na</span>(dep_time, arr_time) <span class="co">#删除dep_time, arr_time为NA的行</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 328,063 × 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      517            515         2      830            819
 2  2013     1     1      533            529         4      850            830
 3  2013     1     1      542            540         2      923            850
 4  2013     1     1      544            545        -1     1004           1022
 5  2013     1     1      554            600        -6      812            837
 6  2013     1     1      554            558        -4      740            728
 7  2013     1     1      555            600        -5      913            854
 8  2013     1     1      557            600        -3      709            723
 9  2013     1     1      557            600        -3      838            846
10  2013     1     1      558            600        -2      753            745
# ℹ 328,053 more rows
# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
</section>
<section id="去重distinct" class="level3" data-number="3.3.4">
<h3 data-number="3.3.4" class="anchored" data-anchor-id="去重distinct"><span class="header-section-number">3.3.4</span> 去重distinct()</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb35-2"><a href="#cb35-2"></a>  <span class="fu">distinct</span>() <span class="co">#移除所有列都相同的行</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      517            515         2      830            819
 2  2013     1     1      533            529         4      850            830
 3  2013     1     1      542            540         2      923            850
 4  2013     1     1      544            545        -1     1004           1022
 5  2013     1     1      554            600        -6      812            837
 6  2013     1     1      554            558        -4      740            728
 7  2013     1     1      555            600        -5      913            854
 8  2013     1     1      557            600        -3      709            723
 9  2013     1     1      557            600        -3      838            846
10  2013     1     1      558            600        -2      753            745
# ℹ 336,766 more rows
# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb37-2"><a href="#cb37-2"></a>  <span class="fu">distinct</span>(year, month, day) <span class="co">#提取year, month, day 的唯一组合</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 365 × 3
    year month   day
   &lt;int&gt; &lt;int&gt; &lt;int&gt;
 1  2013     1     1
 2  2013     1     2
 3  2013     1     3
 4  2013     1     4
 5  2013     1     5
 6  2013     1     6
 7  2013     1     7
 8  2013     1     8
 9  2013     1     9
10  2013     1    10
# ℹ 355 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb39-2"><a href="#cb39-2"></a>  <span class="fu">distinct</span>(origin, dest) <span class="co">#提取year, month, day 的唯一组合</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 224 × 2
   origin dest 
   &lt;chr&gt;  &lt;chr&gt;
 1 EWR    IAH  
 2 LGA    IAH  
 3 JFK    MIA  
 4 JFK    BQN  
 5 LGA    ATL  
 6 EWR    ORD  
 7 EWR    FLL  
 8 LGA    IAD  
 9 JFK    MCO  
10 LGA    ORD  
# ℹ 214 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb41-2"><a href="#cb41-2"></a>  <span class="fu">distinct</span>(origin, dest,    <span class="co">#找到year, month, day 的唯一组合</span></span>
<span id="cb41-3"><a href="#cb41-3"></a>           <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="co">#保留所有的列。 .keep_all默认为FALSE，不保留其余的列</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 224 × 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      517            515         2      830            819
 2  2013     1     1      533            529         4      850            830
 3  2013     1     1      542            540         2      923            850
 4  2013     1     1      544            545        -1     1004           1022
 5  2013     1     1      554            600        -6      812            837
 6  2013     1     1      554            558        -4      740            728
 7  2013     1     1      555            600        -5      913            854
 8  2013     1     1      557            600        -3      709            723
 9  2013     1     1      557            600        -3      838            846
10  2013     1     1      558            600        -2      753            745
# ℹ 214 more rows
# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
</section>
<section id="缺失值is.na" class="level3" data-number="3.3.5">
<h3 data-number="3.3.5" class="anchored" data-anchor-id="缺失值is.na"><span class="header-section-number">3.3.5</span> 缺失值is.na()</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb43-2"><a href="#cb43-2"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(dep_time)) <span class="co">#保留dep_time为NA的行</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8,255 × 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1       NA           1630        NA       NA           1815
 2  2013     1     1       NA           1935        NA       NA           2240
 3  2013     1     1       NA           1500        NA       NA           1825
 4  2013     1     1       NA            600        NA       NA            901
 5  2013     1     2       NA           1540        NA       NA           1747
 6  2013     1     2       NA           1620        NA       NA           1746
 7  2013     1     2       NA           1355        NA       NA           1459
 8  2013     1     2       NA           1420        NA       NA           1644
 9  2013     1     2       NA           1321        NA       NA           1536
10  2013     1     2       NA           1545        NA       NA           1910
# ℹ 8,245 more rows
# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb45-2"><a href="#cb45-2"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(dep_time)) <span class="co">#保留dep_time为NA的行</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 328,521 × 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      517            515         2      830            819
 2  2013     1     1      533            529         4      850            830
 3  2013     1     1      542            540         2      923            850
 4  2013     1     1      544            545        -1     1004           1022
 5  2013     1     1      554            600        -6      812            837
 6  2013     1     1      554            558        -4      740            728
 7  2013     1     1      555            600        -5      913            854
 8  2013     1     1      557            600        -3      709            723
 9  2013     1     1      557            600        -3      838            846
10  2013     1     1      558            600        -2      753            745
# ℹ 328,511 more rows
# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
</section>
<section id="小练习" class="level3" data-number="3.3.6">
<h3 data-number="3.3.6" class="anchored" data-anchor-id="小练习"><span class="header-section-number">3.3.6</span> 小练习</h3>
<p>第1题: 将满足下列条件的航班筛选出来，保存为一个新的数据框christmas_jfk, 该数据框中一共有多少个航班？</p>
<ol type="1">
<li><p>航班出发日期为2013年12月24日.</p></li>
<li><p>出发地(origin)机场是”JFK”.</p></li>
</ol>
<p>John F. Kennedy International Airport, JFK</p>
<p>LaGuardia Airport, LGA</p>
<p>Newark Liberty International Airport, EWR</p>
<ol start="3" type="1">
<li>航空公司(carrier)是”AA”,或者”UA”, 或者”US”.</li>
</ol>
<p>AA, American Airlines.</p>
<p>UA, United Airlines</p>
<p>US, US Airways</p>
<ol start="4" type="1">
<li>将到达延误时长(arr_delay)中有缺失值的行剔除</li>
</ol>
<p>第2题: 对数据框christmas_jfk, 按照到达延误时长(arr_delay)降序排列航班</p>
<p>第3题: 绘制数据框christmas_jfk中出发时间(dep_time)和到达延误时长(arr_delay)的散点图，散点的颜色用航空公司(carrier)来映射, 散点的大小用飞行距离来映射。</p>
<details>
<summary>
code
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a>christmas_jfk <span class="ot">&lt;-</span> flights <span class="sc">%&gt;%</span> </span>
<span id="cb47-2"><a href="#cb47-2"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2013</span> <span class="sc">&amp;</span> month <span class="sc">==</span> <span class="dv">12</span> <span class="sc">&amp;</span> day <span class="sc">==</span> <span class="dv">24</span> <span class="sc">&amp;</span> origin <span class="sc">==</span> <span class="st">"JFK"</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb47-3"><a href="#cb47-3"></a>  <span class="fu">filter</span>(carrier <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"AA"</span>, <span class="st">"UA"</span>, <span class="st">"US"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb47-4"><a href="#cb47-4"></a>  <span class="fu">drop_na</span>(arr_delay) <span class="sc">%&gt;%</span> </span>
<span id="cb47-5"><a href="#cb47-5"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(arr_delay))</span>
<span id="cb47-6"><a href="#cb47-6"></a></span>
<span id="cb47-7"><a href="#cb47-7"></a>christmas_jfk <span class="sc">%&gt;%</span> <span class="fu">print</span>(<span class="at">width =</span> <span class="cn">Inf</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 52 × 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013    12    24     2016           1530       286     2326           1915
 2  2013    12    24      816            750        26     1311           1255
 3  2013    12    24      612            615        -3      829            817
 4  2013    12    24      927            900        27     1237           1225
 5  2013    12    24      717            720        -3     1056           1045
 6  2013    12    24     1210           1200        10     1411           1400
 7  2013    12    24     1909           1900         9     2225           2215
 8  2013    12    24      804            800         4     1144           1135
 9  2013    12    24     1536           1510        26     1852           1845
10  2013    12    24     1700           1700         0     2046           2039
   arr_delay carrier flight tailnum origin dest  air_time distance  hour minute
       &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
 1       251 AA          85 N374AA  JFK    SFO        341     2586    15     30
 2        16 AA         936 N5EUAA  JFK    STT        206     1623     7     50
 3        12 US         840 N558UW  JFK    CLT        112      541     6     15
 4        12 AA           1 N336AA  JFK    LAX        343     2475     9      0
 5        11 AA        1345 N319AA  JFK    MIA        168     1089     7     20
 6        11 US        1817 N540UW  JFK    CLT         88      541    12      0
 7        10 AA          21 N339AA  JFK    LAX        343     2475    19      0
 8         9 AA          59 N377AA  JFK    SFO        364     2586     8      0
 9         7 AA         145 N5FHAA  JFK    MIA        173     1089    15     10
10         7 UA         512 N597UA  JFK    SFO        363     2586    17      0
   time_hour          
   &lt;dttm&gt;             
 1 2013-12-24 15:00:00
 2 2013-12-24 07:00:00
 3 2013-12-24 06:00:00
 4 2013-12-24 09:00:00
 5 2013-12-24 07:00:00
 6 2013-12-24 12:00:00
 7 2013-12-24 19:00:00
 8 2013-12-24 08:00:00
 9 2013-12-24 15:00:00
10 2013-12-24 17:00:00
# ℹ 42 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a><span class="fu">nrow</span>(christmas_jfk)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 52</code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a>christmas_jfk <span class="sc">%&gt;%</span> </span>
<span id="cb51-2"><a href="#cb51-2"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(dep_time, arr_delay, <span class="at">col =</span> carrier, <span class="at">size =</span> distance)) <span class="sc">+</span> </span>
<span id="cb51-3"><a href="#cb51-3"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="script5_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb52-2"><a href="#cb52-2"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2013</span>, month <span class="sc">==</span> <span class="dv">12</span>, day <span class="sc">==</span> <span class="dv">24</span>, </span>
<span id="cb52-3"><a href="#cb52-3"></a>         origin <span class="sc">==</span> <span class="st">"JFK"</span>, carrier <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"AA"</span>, <span class="st">"UA"</span>, <span class="st">"US"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb52-4"><a href="#cb52-4"></a>  <span class="fu">drop_na</span>(arr_delay) <span class="sc">%&gt;%</span> </span>
<span id="cb52-5"><a href="#cb52-5"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(arr_delay)) <span class="sc">%&gt;%</span> </span>
<span id="cb52-6"><a href="#cb52-6"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(dep_time, arr_delay, <span class="at">col =</span> carrier, <span class="at">size =</span> distance)) <span class="sc">+</span> </span>
<span id="cb52-7"><a href="#cb52-7"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="script5_files/figure-html/unnamed-chunk-15-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</details></section>
</section>
<section id="columns" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="columns"><span class="header-section-number">3.4</span> Columns</h2>
<section id="追加变量mutate" class="level3" data-number="3.4.1">
<h3 data-number="3.4.1" class="anchored" data-anchor-id="追加变量mutate"><span class="header-section-number">3.4.1</span> 追加变量mutate()</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb53-2"><a href="#cb53-2"></a>  <span class="fu">mutate</span>(</span>
<span id="cb53-3"><a href="#cb53-3"></a>    <span class="at">gain =</span> arr_delay <span class="sc">-</span> dep_delay, </span>
<span id="cb53-4"><a href="#cb53-4"></a>    <span class="co">#gain = 到达延时 -出发延时。gain为正值,表示航班在飞行过程中增加了延迟，航班延迟增加。gain的负值，表示航班在飞行过程中减少了延迟，航班延迟减少，或者航班提前到达。</span></span>
<span id="cb53-5"><a href="#cb53-5"></a>    <span class="at">speed =</span> distance <span class="sc">/</span> air_time <span class="sc">*</span> <span class="dv">60</span>, <span class="co">#计算飞行速度,</span></span>
<span id="cb53-6"><a href="#cb53-6"></a>    <span class="at">.after =</span> arr_delay  <span class="co">#将gain和speed放在arr_delay列后，默认是放在最后两列</span></span>
<span id="cb53-7"><a href="#cb53-7"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 21
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      517            515         2      830            819
 2  2013     1     1      533            529         4      850            830
 3  2013     1     1      542            540         2      923            850
 4  2013     1     1      544            545        -1     1004           1022
 5  2013     1     1      554            600        -6      812            837
 6  2013     1     1      554            558        -4      740            728
 7  2013     1     1      555            600        -5      913            854
 8  2013     1     1      557            600        -3      709            723
 9  2013     1     1      557            600        -3      838            846
10  2013     1     1      558            600        -2      753            745
# ℹ 336,766 more rows
# ℹ 13 more variables: arr_delay &lt;dbl&gt;, gain &lt;dbl&gt;, speed &lt;dbl&gt;, carrier &lt;chr&gt;,
#   flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,
#   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb55-2"><a href="#cb55-2"></a>  <span class="fu">mutate</span>(</span>
<span id="cb55-3"><a href="#cb55-3"></a>    <span class="at">gain =</span> arr_delay <span class="sc">-</span> dep_delay,</span>
<span id="cb55-4"><a href="#cb55-4"></a>    <span class="at">speed =</span> distance <span class="sc">/</span> air_time <span class="sc">*</span> <span class="dv">60</span>,</span>
<span id="cb55-5"><a href="#cb55-5"></a>    <span class="at">.before =</span> <span class="dv">1</span>) <span class="co">#将gain和speed放在第1列,第2列</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 21
    gain speed  year month   day dep_time sched_dep_time dep_delay arr_time
   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
 1     9  370.  2013     1     1      517            515         2      830
 2    16  374.  2013     1     1      533            529         4      850
 3    31  408.  2013     1     1      542            540         2      923
 4   -17  517.  2013     1     1      544            545        -1     1004
 5   -19  394.  2013     1     1      554            600        -6      812
 6    16  288.  2013     1     1      554            558        -4      740
 7    24  404.  2013     1     1      555            600        -5      913
 8   -11  259.  2013     1     1      557            600        -3      709
 9    -5  405.  2013     1     1      557            600        -3      838
10    10  319.  2013     1     1      558            600        -2      753
# ℹ 336,766 more rows
# ℹ 12 more variables: sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;,
#   flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,
#   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb57-2"><a href="#cb57-2"></a>  <span class="fu">mutate</span>(</span>
<span id="cb57-3"><a href="#cb57-3"></a>    <span class="at">gain =</span> arr_delay <span class="sc">-</span> dep_delay,</span>
<span id="cb57-4"><a href="#cb57-4"></a>    <span class="at">speed =</span> distance <span class="sc">/</span> air_time <span class="sc">*</span> <span class="dv">60</span>,</span>
<span id="cb57-5"><a href="#cb57-5"></a>    <span class="at">.after =</span> day) <span class="co">#将gain和speed放在day列后</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 21
    year month   day  gain speed dep_time sched_dep_time dep_delay arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
 1  2013     1     1     9  370.      517            515         2      830
 2  2013     1     1    16  374.      533            529         4      850
 3  2013     1     1    31  408.      542            540         2      923
 4  2013     1     1   -17  517.      544            545        -1     1004
 5  2013     1     1   -19  394.      554            600        -6      812
 6  2013     1     1    16  288.      554            558        -4      740
 7  2013     1     1    24  404.      555            600        -5      913
 8  2013     1     1   -11  259.      557            600        -3      709
 9  2013     1     1    -5  405.      557            600        -3      838
10  2013     1     1    10  319.      558            600        -2      753
# ℹ 336,766 more rows
# ℹ 12 more variables: sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;,
#   flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,
#   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
<p>注意：</p>
<p>当运行mutate() 时，追加变量，console中显示了追加的结果，但不会修改现有的数据框。</p>
<p>要保存这个新的数据框，需要将其赋值&lt;-。</p>
</section>
<section id="选择变量select" class="level3" data-number="3.4.2">
<h3 data-number="3.4.2" class="anchored" data-anchor-id="选择变量select"><span class="header-section-number">3.4.2</span> 选择变量select()</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb59-2"><a href="#cb59-2"></a>  <span class="fu">select</span>(year, month, day) <span class="co">#选择year, month, day列</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 3
    year month   day
   &lt;int&gt; &lt;int&gt; &lt;int&gt;
 1  2013     1     1
 2  2013     1     1
 3  2013     1     1
 4  2013     1     1
 5  2013     1     1
 6  2013     1     1
 7  2013     1     1
 8  2013     1     1
 9  2013     1     1
10  2013     1     1
# ℹ 336,766 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb61-2"><a href="#cb61-2"></a>  <span class="fu">select</span>(year<span class="sc">:</span>day) <span class="co">#选择year到day列</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 3
    year month   day
   &lt;int&gt; &lt;int&gt; &lt;int&gt;
 1  2013     1     1
 2  2013     1     1
 3  2013     1     1
 4  2013     1     1
 5  2013     1     1
 6  2013     1     1
 7  2013     1     1
 8  2013     1     1
 9  2013     1     1
10  2013     1     1
# ℹ 336,766 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb63-2"><a href="#cb63-2"></a>  <span class="fu">select</span>(year<span class="sc">:</span>day, <span class="fu">ends_with</span>(<span class="st">"delay"</span>)) <span class="co">#选择year到day列和以delay结尾的列</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 5
    year month   day dep_delay arr_delay
   &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;
 1  2013     1     1         2        11
 2  2013     1     1         4        20
 3  2013     1     1         2        33
 4  2013     1     1        -1       -18
 5  2013     1     1        -6       -25
 6  2013     1     1        -4        12
 7  2013     1     1        -5        19
 8  2013     1     1        -3       -14
 9  2013     1     1        -3        -8
10  2013     1     1        -2         8
# ℹ 336,766 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb65-2"><a href="#cb65-2"></a>  <span class="fu">select</span>(<span class="sc">!</span>year<span class="sc">:</span>day) <span class="co">#选择除year到day列之外的列</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 16
   dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier
      &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;  
 1      517            515         2      830            819        11 UA     
 2      533            529         4      850            830        20 UA     
 3      542            540         2      923            850        33 AA     
 4      544            545        -1     1004           1022       -18 B6     
 5      554            600        -6      812            837       -25 DL     
 6      554            558        -4      740            728        12 UA     
 7      555            600        -5      913            854        19 B6     
 8      557            600        -3      709            723       -14 EV     
 9      557            600        -3      838            846        -8 B6     
10      558            600        -2      753            745         8 AA     
# ℹ 336,766 more rows
# ℹ 9 more variables: flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
#   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb67-2"><a href="#cb67-2"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.character)) <span class="co">#选择类型是字符串的列</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 4
   carrier tailnum origin dest 
   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;
 1 UA      N14228  EWR    IAH  
 2 UA      N24211  LGA    IAH  
 3 AA      N619AA  JFK    MIA  
 4 B6      N804JB  JFK    BQN  
 5 DL      N668DN  LGA    ATL  
 6 UA      N39463  EWR    ORD  
 7 B6      N516JB  EWR    FLL  
 8 EV      N829AS  LGA    IAD  
 9 B6      N593JB  JFK    MCO  
10 AA      N3ALAA  LGA    ORD  
# ℹ 336,766 more rows</code></pre>
</div>
</div>
<p>There are a number of helper functions you can use within select():</p>
<ul>
<li><p>starts_with(“abc”): matches names that begin with “abc”.</p></li>
<li><p>ends_with(“xyz”): matches names that end with “xyz”.</p></li>
<li><p>contains(“ijk”): matches names that contain “ijk”.</p></li>
<li><p>num_range(“x”, 1:3): matches x1, x2 and x3.</p></li>
</ul>
</section>
<section id="重命名变量rename" class="level3" data-number="3.4.3">
<h3 data-number="3.4.3" class="anchored" data-anchor-id="重命名变量rename"><span class="header-section-number">3.4.3</span> 重命名变量rename()</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb69-2"><a href="#cb69-2"></a>  <span class="fu">rename</span>(<span class="at">tail_num =</span> tailnum) <span class="co"># 新名称 = 旧名称</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      517            515         2      830            819
 2  2013     1     1      533            529         4      850            830
 3  2013     1     1      542            540         2      923            850
 4  2013     1     1      544            545        -1     1004           1022
 5  2013     1     1      554            600        -6      812            837
 6  2013     1     1      554            558        -4      740            728
 7  2013     1     1      555            600        -5      913            854
 8  2013     1     1      557            600        -3      709            723
 9  2013     1     1      557            600        -3      838            846
10  2013     1     1      558            600        -2      753            745
# ℹ 336,766 more rows
# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tail_num &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1"></a><span class="co"># 保存重命名后的数据框</span></span>
<span id="cb71-2"><a href="#cb71-2"></a>mydata <span class="ot">&lt;-</span> flights <span class="sc">%&gt;%</span> </span>
<span id="cb71-3"><a href="#cb71-3"></a>  <span class="fu">rename</span>(<span class="at">tail_num =</span> tailnum) <span class="co"># 新名称 = 旧名称</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="二值转换if_else" class="level3" data-number="3.4.4">
<h3 data-number="3.4.4" class="anchored" data-anchor-id="二值转换if_else"><span class="header-section-number">3.4.4</span> 二值转换if_else()</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb72-2"><a href="#cb72-2"></a>  <span class="fu">mutate</span>(<span class="at">season =</span> <span class="fu">if_else</span>(month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>), <span class="st">"summer"</span>, <span class="st">"non-summer"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb72-3"><a href="#cb72-3"></a>  <span class="fu">relocate</span>(season, <span class="at">.before =</span> month) <span class="co">#将season列放在month列前</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 20
    year season     month   day dep_time sched_dep_time dep_delay arr_time
   &lt;int&gt; &lt;chr&gt;      &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
 1  2013 non-summer     1     1      517            515         2      830
 2  2013 non-summer     1     1      533            529         4      850
 3  2013 non-summer     1     1      542            540         2      923
 4  2013 non-summer     1     1      544            545        -1     1004
 5  2013 non-summer     1     1      554            600        -6      812
 6  2013 non-summer     1     1      554            558        -4      740
 7  2013 non-summer     1     1      555            600        -5      913
 8  2013 non-summer     1     1      557            600        -3      709
 9  2013 non-summer     1     1      557            600        -3      838
10  2013 non-summer     1     1      558            600        -2      753
# ℹ 336,766 more rows
# ℹ 12 more variables: sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;,
#   flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,
#   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
</section>
<section id="多值转换case_when" class="level3" data-number="3.4.5">
<h3 data-number="3.4.5" class="anchored" data-anchor-id="多值转换case_when"><span class="header-section-number">3.4.5</span> 多值转换case_when()</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1"></a>flights  <span class="sc">%&gt;%</span>  </span>
<span id="cb74-2"><a href="#cb74-2"></a>  <span class="fu">mutate</span>(</span>
<span id="cb74-3"><a href="#cb74-3"></a>    <span class="at">status =</span> <span class="fu">case_when</span>(</span>
<span id="cb74-4"><a href="#cb74-4"></a>      <span class="fu">is.na</span>(arr_delay)      <span class="sc">~</span> <span class="st">"cancelled"</span>, <span class="co">#如果arr_delay为NA,则status为cancelled</span></span>
<span id="cb74-5"><a href="#cb74-5"></a>      arr_delay <span class="sc">&lt;</span> <span class="sc">-</span><span class="dv">30</span>       <span class="sc">~</span> <span class="st">"very early"</span>, <span class="co">#如果航班提前超过30分钟到达，status为"very early"</span></span>
<span id="cb74-6"><a href="#cb74-6"></a>      arr_delay <span class="sc">&lt;</span> <span class="sc">-</span><span class="dv">15</span>       <span class="sc">~</span> <span class="st">"early"</span>, <span class="co">#如果航班提前15到30分钟到达，status为"early"</span></span>
<span id="cb74-7"><a href="#cb74-7"></a>      <span class="fu">abs</span>(arr_delay) <span class="sc">&lt;=</span> <span class="dv">15</span>  <span class="sc">~</span> <span class="st">"on time"</span>, <span class="co">#如果航班提前或延迟在15分钟以内，status为"on time"</span></span>
<span id="cb74-8"><a href="#cb74-8"></a>      arr_delay <span class="sc">&lt;</span> <span class="dv">60</span>        <span class="sc">~</span> <span class="st">"late"</span>, <span class="co">#如果航班延迟小于60分钟，status为"late"</span></span>
<span id="cb74-9"><a href="#cb74-9"></a>      arr_delay <span class="sc">&lt;</span> <span class="cn">Inf</span>       <span class="sc">~</span> <span class="st">"very late"</span>, <span class="co">#如果航班延迟大于等于60分钟，status为"late"</span></span>
<span id="cb74-10"><a href="#cb74-10"></a>    ),</span>
<span id="cb74-11"><a href="#cb74-11"></a>    <span class="at">.after =</span> arr_delay) <span class="co">#将status列放在arr_delay列后</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 20
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      517            515         2      830            819
 2  2013     1     1      533            529         4      850            830
 3  2013     1     1      542            540         2      923            850
 4  2013     1     1      544            545        -1     1004           1022
 5  2013     1     1      554            600        -6      812            837
 6  2013     1     1      554            558        -4      740            728
 7  2013     1     1      555            600        -5      913            854
 8  2013     1     1      557            600        -3      709            723
 9  2013     1     1      557            600        -3      838            846
10  2013     1     1      558            600        -2      753            745
# ℹ 336,766 more rows
# ℹ 12 more variables: arr_delay &lt;dbl&gt;, status &lt;chr&gt;, carrier &lt;chr&gt;,
#   flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,
#   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
</section>
<section id="重新编码recode" class="level3" data-number="3.4.6">
<h3 data-number="3.4.6" class="anchored" data-anchor-id="重新编码recode"><span class="header-section-number">3.4.6</span> 重新编码recode()</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1"></a><span class="co"># recode()函数 旧值 = 新值</span></span>
<span id="cb76-2"><a href="#cb76-2"></a><span class="co"># case_when 适合于复杂条件的转换</span></span>
<span id="cb76-3"><a href="#cb76-3"></a></span>
<span id="cb76-4"><a href="#cb76-4"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb76-5"><a href="#cb76-5"></a>  <span class="fu">mutate</span>(<span class="at">quarter =</span> <span class="fu">recode</span>(month,</span>
<span id="cb76-6"><a href="#cb76-6"></a>                         <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"Winter"</span>, <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"Winter"</span>, <span class="st">"12"</span> <span class="ot">=</span> <span class="st">"Winter"</span>, </span>
<span id="cb76-7"><a href="#cb76-7"></a>                         <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"Spring"</span>, <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"Spring"</span>, <span class="st">"5"</span> <span class="ot">=</span> <span class="st">"Spring"</span>,</span>
<span id="cb76-8"><a href="#cb76-8"></a>                         <span class="st">"6"</span> <span class="ot">=</span> <span class="st">"Summer"</span>, <span class="st">"7"</span> <span class="ot">=</span> <span class="st">"Summer"</span>, <span class="st">"8"</span> <span class="ot">=</span> <span class="st">"Summer"</span>,</span>
<span id="cb76-9"><a href="#cb76-9"></a>                         <span class="st">"9"</span> <span class="ot">=</span> <span class="st">"Fall"</span>, <span class="st">"10"</span> <span class="ot">=</span> <span class="st">"Fall"</span>, <span class="st">"11"</span> <span class="ot">=</span> <span class="st">"Fall"</span>),</span>
<span id="cb76-10"><a href="#cb76-10"></a>         <span class="at">.before =</span> month)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 20
    year quarter month   day dep_time sched_dep_time dep_delay arr_time
   &lt;int&gt; &lt;chr&gt;   &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
 1  2013 Winter      1     1      517            515         2      830
 2  2013 Winter      1     1      533            529         4      850
 3  2013 Winter      1     1      542            540         2      923
 4  2013 Winter      1     1      544            545        -1     1004
 5  2013 Winter      1     1      554            600        -6      812
 6  2013 Winter      1     1      554            558        -4      740
 7  2013 Winter      1     1      555            600        -5      913
 8  2013 Winter      1     1      557            600        -3      709
 9  2013 Winter      1     1      557            600        -3      838
10  2013 Winter      1     1      558            600        -2      753
# ℹ 336,766 more rows
# ℹ 12 more variables: sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;,
#   flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,
#   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1"></a><span class="co"># 用case_when()更简洁</span></span>
<span id="cb78-2"><a href="#cb78-2"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb78-3"><a href="#cb78-3"></a>  <span class="fu">mutate</span>(<span class="at">quarter =</span> <span class="fu">case_when</span>(</span>
<span id="cb78-4"><a href="#cb78-4"></a>    month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">2</span>) <span class="sc">~</span> <span class="st">"Winter"</span>,</span>
<span id="cb78-5"><a href="#cb78-5"></a>    month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>) <span class="sc">~</span> <span class="st">"Spring"</span>,</span>
<span id="cb78-6"><a href="#cb78-6"></a>    month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>) <span class="sc">~</span> <span class="st">"Summer"</span>,</span>
<span id="cb78-7"><a href="#cb78-7"></a>    month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>) <span class="sc">~</span> <span class="st">"Fall"</span></span>
<span id="cb78-8"><a href="#cb78-8"></a>  ), </span>
<span id="cb78-9"><a href="#cb78-9"></a>  <span class="at">.before =</span> month)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 20
    year quarter month   day dep_time sched_dep_time dep_delay arr_time
   &lt;int&gt; &lt;chr&gt;   &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
 1  2013 Winter      1     1      517            515         2      830
 2  2013 Winter      1     1      533            529         4      850
 3  2013 Winter      1     1      542            540         2      923
 4  2013 Winter      1     1      544            545        -1     1004
 5  2013 Winter      1     1      554            600        -6      812
 6  2013 Winter      1     1      554            558        -4      740
 7  2013 Winter      1     1      555            600        -5      913
 8  2013 Winter      1     1      557            600        -3      709
 9  2013 Winter      1     1      557            600        -3      838
10  2013 Winter      1     1      558            600        -2      753
# ℹ 336,766 more rows
# ℹ 12 more variables: sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;,
#   flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,
#   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb80-2"><a href="#cb80-2"></a>  <span class="fu">mutate</span>(<span class="at">company =</span> <span class="fu">recode</span>(carrier,</span>
<span id="cb80-3"><a href="#cb80-3"></a>                          <span class="st">"9E"</span> <span class="ot">=</span> <span class="st">"Endeavor Air"</span>,</span>
<span id="cb80-4"><a href="#cb80-4"></a>                          <span class="st">"AA"</span> <span class="ot">=</span> <span class="st">"American Airlines"</span>,</span>
<span id="cb80-5"><a href="#cb80-5"></a>                          <span class="st">"AS"</span> <span class="ot">=</span> <span class="st">"Alaska Airlines"</span>,</span>
<span id="cb80-6"><a href="#cb80-6"></a>                          <span class="st">"B6"</span> <span class="ot">=</span> <span class="st">"JetBlue Airways"</span>,</span>
<span id="cb80-7"><a href="#cb80-7"></a>                          <span class="st">"DL"</span> <span class="ot">=</span> <span class="st">"Delta Air Lines"</span>,</span>
<span id="cb80-8"><a href="#cb80-8"></a>                          <span class="st">"EV"</span> <span class="ot">=</span> <span class="st">"ExpressJet Airlines"</span>,</span>
<span id="cb80-9"><a href="#cb80-9"></a>                          <span class="st">"F9"</span> <span class="ot">=</span> <span class="st">"Frontier Airlines"</span>,</span>
<span id="cb80-10"><a href="#cb80-10"></a>                          <span class="st">"FL"</span> <span class="ot">=</span> <span class="st">"AirTran Airways"</span>,</span>
<span id="cb80-11"><a href="#cb80-11"></a>                          <span class="st">"HA"</span> <span class="ot">=</span> <span class="st">"Hawaiian Airlines"</span>,</span>
<span id="cb80-12"><a href="#cb80-12"></a>                          <span class="st">"MQ"</span> <span class="ot">=</span> <span class="st">"Envoy Air"</span>,</span>
<span id="cb80-13"><a href="#cb80-13"></a>                          <span class="st">"OO"</span> <span class="ot">=</span> <span class="st">"SkyWest Airlines"</span>,</span>
<span id="cb80-14"><a href="#cb80-14"></a>                          <span class="st">"UA"</span> <span class="ot">=</span> <span class="st">"United Airlines"</span>,</span>
<span id="cb80-15"><a href="#cb80-15"></a>                          <span class="st">"US"</span> <span class="ot">=</span> <span class="st">"US Airways"</span>,</span>
<span id="cb80-16"><a href="#cb80-16"></a>                          <span class="st">"VX"</span> <span class="ot">=</span> <span class="st">"Virgin America"</span>,</span>
<span id="cb80-17"><a href="#cb80-17"></a>                          <span class="st">"WN"</span> <span class="ot">=</span> <span class="st">"Southwest Airlines"</span>,</span>
<span id="cb80-18"><a href="#cb80-18"></a>                          <span class="st">"YV"</span> <span class="ot">=</span> <span class="st">"Mesa Airlines"</span>),</span>
<span id="cb80-19"><a href="#cb80-19"></a>         <span class="at">.after =</span> carrier)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 20
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      517            515         2      830            819
 2  2013     1     1      533            529         4      850            830
 3  2013     1     1      542            540         2      923            850
 4  2013     1     1      544            545        -1     1004           1022
 5  2013     1     1      554            600        -6      812            837
 6  2013     1     1      554            558        -4      740            728
 7  2013     1     1      555            600        -5      913            854
 8  2013     1     1      557            600        -3      709            723
 9  2013     1     1      557            600        -3      838            846
10  2013     1     1      558            600        -2      753            745
# ℹ 336,766 more rows
# ℹ 12 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, company &lt;chr&gt;,
#   flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,
#   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
</section>
<section id="前置变量relocate" class="level3" data-number="3.4.7">
<h3 data-number="3.4.7" class="anchored" data-anchor-id="前置变量relocate"><span class="header-section-number">3.4.7</span> 前置变量relocate()</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb82-2"><a href="#cb82-2"></a>  <span class="fu">relocate</span>(time_hour, air_time) <span class="co">#将time_hour, air_time放到最前面</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 19
   time_hour           air_time  year month   day dep_time sched_dep_time
   &lt;dttm&gt;                 &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;
 1 2013-01-01 05:00:00      227  2013     1     1      517            515
 2 2013-01-01 05:00:00      227  2013     1     1      533            529
 3 2013-01-01 05:00:00      160  2013     1     1      542            540
 4 2013-01-01 05:00:00      183  2013     1     1      544            545
 5 2013-01-01 06:00:00      116  2013     1     1      554            600
 6 2013-01-01 05:00:00      150  2013     1     1      554            558
 7 2013-01-01 06:00:00      158  2013     1     1      555            600
 8 2013-01-01 06:00:00       53  2013     1     1      557            600
 9 2013-01-01 06:00:00      140  2013     1     1      557            600
10 2013-01-01 06:00:00      138  2013     1     1      558            600
# ℹ 336,766 more rows
# ℹ 12 more variables: dep_delay &lt;dbl&gt;, arr_time &lt;int&gt;, sched_arr_time &lt;int&gt;,
#   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;,
#   dest &lt;chr&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="小练习-1" class="level3" data-number="3.4.8">
<h3 data-number="3.4.8" class="anchored" data-anchor-id="小练习-1"><span class="header-section-number">3.4.8</span> 小练习</h3>
<p>第1题：将出发地(origin)是”JFK”机场的航班筛选出来, 创建数据框jfk_flights, 在该数据框中追加如下变量：</p>
<ol type="1">
<li>追加新变量distance_group。根据distance(单位：英里)的数值，将航班分为短途、中途和长途三类。 distance_group值为”short”, “medium”, “long”。distance_group与distance的对应关系如下：</li>
</ol>
<ul>
<li><p>短途飞行（Short-haul flight）：飞行距离少于500英里的航班。</p></li>
<li><p>中途飞行（Medium-haul flight）：飞行距离在500到1,550英里之间的航班。</p></li>
<li><p>长途飞行（Long-haul flight）：飞行距离超过1,550英里的航班</p></li>
</ul>
<ol start="2" type="1">
<li><p>追加新变量status。若arr_delay的值为缺失值，则status等于cancelled，若arr_delay的值不是缺失值，则status等于normal。</p></li>
<li><p>追加新变量month_name，将month的值转换为月份的英文名称，例如1转换为January，2转换为February，以此类推。</p></li>
</ol>
<p>第2题：绘制出第1题中得到的数据框jfk_flights中航班数量的条形图，横坐标为月份的英文名称，纵坐标为航班数量。</p>
<p>第3题：绘制出第1题中得到的数据框jfk_flights中每个月份的取消/正常航班数量的条形图，横坐标为月份的英文名称，纵坐标为航班数量。</p>
<details>
<summary>
code
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1"></a><span class="co"># 筛选出发地为"JFK"的航班</span></span>
<span id="cb84-2"><a href="#cb84-2"></a>jfk_flights <span class="ot">&lt;-</span> flights <span class="sc">%&gt;%</span> </span>
<span id="cb84-3"><a href="#cb84-3"></a>  <span class="fu">filter</span>(origin <span class="sc">==</span> <span class="st">"JFK"</span>)</span>
<span id="cb84-4"><a href="#cb84-4"></a></span>
<span id="cb84-5"><a href="#cb84-5"></a><span class="co"># 追加新变量distance_group, status和month_name</span></span>
<span id="cb84-6"><a href="#cb84-6"></a>jfk_flights <span class="ot">&lt;-</span> jfk_flights <span class="sc">%&gt;%</span></span>
<span id="cb84-7"><a href="#cb84-7"></a>  <span class="fu">mutate</span>(</span>
<span id="cb84-8"><a href="#cb84-8"></a>    <span class="at">distance_group =</span> <span class="fu">case_when</span>(</span>
<span id="cb84-9"><a href="#cb84-9"></a>      distance <span class="sc">&lt;</span> <span class="dv">500</span> <span class="sc">~</span> <span class="st">"short"</span>,</span>
<span id="cb84-10"><a href="#cb84-10"></a>      distance <span class="sc">&gt;=</span> <span class="dv">500</span> <span class="sc">&amp;</span> distance <span class="sc">&lt;=</span> <span class="dv">1550</span> <span class="sc">~</span> <span class="st">"medium"</span>,</span>
<span id="cb84-11"><a href="#cb84-11"></a>      distance <span class="sc">&gt;</span> <span class="dv">1550</span> <span class="sc">~</span> <span class="st">"long"</span></span>
<span id="cb84-12"><a href="#cb84-12"></a>    ),</span>
<span id="cb84-13"><a href="#cb84-13"></a>    <span class="at">status =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(arr_delay), <span class="st">"cancelled"</span>, <span class="st">"normal"</span>),</span>
<span id="cb84-14"><a href="#cb84-14"></a>    <span class="at">month_name =</span> month.abb[month],  <span class="co"># 使用内置的月份缩写向量month.abb</span></span>
<span id="cb84-15"><a href="#cb84-15"></a>    <span class="at">.after =</span> day  <span class="co"># 将新变量放在day列后</span></span>
<span id="cb84-16"><a href="#cb84-16"></a>  )</span>
<span id="cb84-17"><a href="#cb84-17"></a></span>
<span id="cb84-18"><a href="#cb84-18"></a>jfk_flights</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 111,279 × 22
    year month   day distance_group status month_name dep_time sched_dep_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;          &lt;chr&gt;  &lt;chr&gt;         &lt;int&gt;          &lt;int&gt;
 1  2013     1     1 medium         normal Jan             542            540
 2  2013     1     1 long           normal Jan             544            545
 3  2013     1     1 medium         normal Jan             557            600
 4  2013     1     1 medium         normal Jan             558            600
 5  2013     1     1 medium         normal Jan             558            600
 6  2013     1     1 long           normal Jan             558            600
 7  2013     1     1 short          normal Jan             559            559
 8  2013     1     1 medium         normal Jan             606            610
 9  2013     1     1 long           normal Jan             611            600
10  2013     1     1 medium         normal Jan             613            610
# ℹ 111,269 more rows
# ℹ 14 more variables: dep_delay &lt;dbl&gt;, arr_time &lt;int&gt;, sched_arr_time &lt;int&gt;,
#   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;,
#   dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,
#   time_hour &lt;dttm&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1"></a><span class="co"># 将month_name转换为有序因子，确保月份按自然顺序排序</span></span>
<span id="cb86-2"><a href="#cb86-2"></a>jfk_flights<span class="sc">$</span>month_name <span class="ot">&lt;-</span> <span class="fu">factor</span>(jfk_flights<span class="sc">$</span>month_name, </span>
<span id="cb86-3"><a href="#cb86-3"></a>                                    <span class="at">levels =</span> month.abb, </span>
<span id="cb86-4"><a href="#cb86-4"></a>                                    <span class="at">ordered =</span> <span class="cn">TRUE</span>)</span>
<span id="cb86-5"><a href="#cb86-5"></a></span>
<span id="cb86-6"><a href="#cb86-6"></a><span class="co"># 绘制柱状图</span></span>
<span id="cb86-7"><a href="#cb86-7"></a><span class="fu">ggplot</span>(jfk_flights, <span class="fu">aes</span>(<span class="at">x =</span> month_name, <span class="at">fill =</span> month_name)) <span class="sc">+</span></span>
<span id="cb86-8"><a href="#cb86-8"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb86-9"><a href="#cb86-9"></a>  <span class="fu">xlab</span>(<span class="st">"Month"</span>) <span class="sc">+</span></span>
<span id="cb86-10"><a href="#cb86-10"></a>  <span class="fu">ylab</span>(<span class="st">"Number of Flights"</span>) <span class="sc">+</span></span>
<span id="cb86-11"><a href="#cb86-11"></a>  <span class="fu">ggtitle</span>(<span class="st">"Number of Flights from JFK by Month"</span>) <span class="sc">+</span></span>
<span id="cb86-12"><a href="#cb86-12"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb86-13"><a href="#cb86-13"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="co"># 优化x轴标签显示</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="script5_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1"></a><span class="co"># 绘制帕累托图</span></span>
<span id="cb87-2"><a href="#cb87-2"></a><span class="fu">ggplot</span>(jfk_flights, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">fct_infreq</span>(month_name), <span class="at">fill =</span> month_name)) <span class="sc">+</span></span>
<span id="cb87-3"><a href="#cb87-3"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb87-4"><a href="#cb87-4"></a>  <span class="fu">xlab</span>(<span class="st">"Month"</span>) <span class="sc">+</span></span>
<span id="cb87-5"><a href="#cb87-5"></a>  <span class="fu">ylab</span>(<span class="st">"Number of Flights"</span>) <span class="sc">+</span></span>
<span id="cb87-6"><a href="#cb87-6"></a>  <span class="fu">ggtitle</span>(<span class="st">"Number of Flights from JFK by Month"</span>) <span class="sc">+</span></span>
<span id="cb87-7"><a href="#cb87-7"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb87-8"><a href="#cb87-8"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="co"># 优化x轴标签显示</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="script5_files/figure-html/unnamed-chunk-24-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1"></a><span class="co"># 绘制柱状图</span></span>
<span id="cb88-2"><a href="#cb88-2"></a><span class="fu">ggplot</span>(jfk_flights, <span class="fu">aes</span>(<span class="at">x =</span> month_name, <span class="at">fill =</span> month_name)) <span class="sc">+</span></span>
<span id="cb88-3"><a href="#cb88-3"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb88-4"><a href="#cb88-4"></a>  <span class="fu">facet_wrap</span>( <span class="sc">~</span> status, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span>  <span class="co"># 按status分面，y轴自由缩放</span></span>
<span id="cb88-5"><a href="#cb88-5"></a>  <span class="fu">xlab</span>(<span class="st">"Month"</span>) <span class="sc">+</span></span>
<span id="cb88-6"><a href="#cb88-6"></a>  <span class="fu">ylab</span>(<span class="st">"Number of Flights"</span>) <span class="sc">+</span></span>
<span id="cb88-7"><a href="#cb88-7"></a>  <span class="fu">ggtitle</span>(<span class="st">"Number of Flights from JFK by Month"</span>) <span class="sc">+</span></span>
<span id="cb88-8"><a href="#cb88-8"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb88-9"><a href="#cb88-9"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="co"># 优化x轴标签显示</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="script5_files/figure-html/unnamed-chunk-24-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</details></section>
</section>
<section id="the-pipe" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="the-pipe"><span class="header-section-number">3.5</span> The pipe</h2>
<p>合并追加变量的代码,并保存到flights_new数据框中</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1"></a><span class="co">#追加gain, status, quarter和company</span></span>
<span id="cb89-2"><a href="#cb89-2"></a></span>
<span id="cb89-3"><a href="#cb89-3"></a>flights_new <span class="ot">&lt;-</span> flights <span class="sc">%&gt;%</span> </span>
<span id="cb89-4"><a href="#cb89-4"></a>  <span class="fu">mutate</span>(</span>
<span id="cb89-5"><a href="#cb89-5"></a>    <span class="at">gain =</span> arr_delay <span class="sc">-</span> dep_delay,</span>
<span id="cb89-6"><a href="#cb89-6"></a>    <span class="at">speed =</span> distance <span class="sc">/</span> air_time <span class="sc">*</span> <span class="dv">60</span>,</span>
<span id="cb89-7"><a href="#cb89-7"></a>    <span class="at">.after =</span> arr_delay) <span class="sc">%&gt;%</span></span>
<span id="cb89-8"><a href="#cb89-8"></a>    <span class="fu">mutate</span>(</span>
<span id="cb89-9"><a href="#cb89-9"></a>    <span class="at">status =</span> <span class="fu">case_when</span>(</span>
<span id="cb89-10"><a href="#cb89-10"></a>      <span class="fu">is.na</span>(arr_delay)      <span class="sc">~</span> <span class="st">"cancelled"</span>, </span>
<span id="cb89-11"><a href="#cb89-11"></a>      arr_delay <span class="sc">&lt;</span> <span class="sc">-</span><span class="dv">30</span>       <span class="sc">~</span> <span class="st">"very early"</span>, </span>
<span id="cb89-12"><a href="#cb89-12"></a>      arr_delay <span class="sc">&lt;</span> <span class="sc">-</span><span class="dv">15</span>       <span class="sc">~</span> <span class="st">"early"</span>, </span>
<span id="cb89-13"><a href="#cb89-13"></a>      <span class="fu">abs</span>(arr_delay) <span class="sc">&lt;=</span> <span class="dv">15</span>  <span class="sc">~</span> <span class="st">"on time"</span>, </span>
<span id="cb89-14"><a href="#cb89-14"></a>      arr_delay <span class="sc">&lt;</span> <span class="dv">60</span>        <span class="sc">~</span> <span class="st">"late"</span>, </span>
<span id="cb89-15"><a href="#cb89-15"></a>      arr_delay <span class="sc">&lt;</span> <span class="cn">Inf</span>       <span class="sc">~</span> <span class="st">"very late"</span>, </span>
<span id="cb89-16"><a href="#cb89-16"></a>    ),</span>
<span id="cb89-17"><a href="#cb89-17"></a>    <span class="at">.after =</span> arr_delay) <span class="sc">%&gt;%</span> </span>
<span id="cb89-18"><a href="#cb89-18"></a>  <span class="fu">mutate</span>(<span class="at">quarter =</span> <span class="fu">case_when</span>(</span>
<span id="cb89-19"><a href="#cb89-19"></a>    month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">2</span>) <span class="sc">~</span> <span class="st">"Winter"</span>,</span>
<span id="cb89-20"><a href="#cb89-20"></a>    month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>) <span class="sc">~</span> <span class="st">"Spring"</span>,</span>
<span id="cb89-21"><a href="#cb89-21"></a>    month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>) <span class="sc">~</span> <span class="st">"Summer"</span>,</span>
<span id="cb89-22"><a href="#cb89-22"></a>    month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>) <span class="sc">~</span> <span class="st">"Fall"</span></span>
<span id="cb89-23"><a href="#cb89-23"></a>  ), </span>
<span id="cb89-24"><a href="#cb89-24"></a>  <span class="at">.before =</span> month) <span class="sc">%&gt;%</span></span>
<span id="cb89-25"><a href="#cb89-25"></a>  <span class="fu">mutate</span>(<span class="at">company =</span> <span class="fu">recode</span>(carrier,</span>
<span id="cb89-26"><a href="#cb89-26"></a>                          <span class="st">"9E"</span> <span class="ot">=</span> <span class="st">"Endeavor Air"</span>,</span>
<span id="cb89-27"><a href="#cb89-27"></a>                          <span class="st">"AA"</span> <span class="ot">=</span> <span class="st">"American Airlines"</span>,</span>
<span id="cb89-28"><a href="#cb89-28"></a>                          <span class="st">"AS"</span> <span class="ot">=</span> <span class="st">"Alaska Airlines"</span>,</span>
<span id="cb89-29"><a href="#cb89-29"></a>                          <span class="st">"B6"</span> <span class="ot">=</span> <span class="st">"JetBlue Airways"</span>,</span>
<span id="cb89-30"><a href="#cb89-30"></a>                          <span class="st">"DL"</span> <span class="ot">=</span> <span class="st">"Delta Air Lines"</span>,</span>
<span id="cb89-31"><a href="#cb89-31"></a>                          <span class="st">"EV"</span> <span class="ot">=</span> <span class="st">"ExpressJet Airlines"</span>,</span>
<span id="cb89-32"><a href="#cb89-32"></a>                          <span class="st">"F9"</span> <span class="ot">=</span> <span class="st">"Frontier Airlines"</span>,</span>
<span id="cb89-33"><a href="#cb89-33"></a>                          <span class="st">"FL"</span> <span class="ot">=</span> <span class="st">"AirTran Airways"</span>,</span>
<span id="cb89-34"><a href="#cb89-34"></a>                          <span class="st">"HA"</span> <span class="ot">=</span> <span class="st">"Hawaiian Airlines"</span>,</span>
<span id="cb89-35"><a href="#cb89-35"></a>                          <span class="st">"MQ"</span> <span class="ot">=</span> <span class="st">"Envoy Air"</span>,</span>
<span id="cb89-36"><a href="#cb89-36"></a>                          <span class="st">"OO"</span> <span class="ot">=</span> <span class="st">"SkyWest Airlines"</span>,</span>
<span id="cb89-37"><a href="#cb89-37"></a>                          <span class="st">"UA"</span> <span class="ot">=</span> <span class="st">"United Airlines"</span>,</span>
<span id="cb89-38"><a href="#cb89-38"></a>                          <span class="st">"US"</span> <span class="ot">=</span> <span class="st">"US Airways"</span>,</span>
<span id="cb89-39"><a href="#cb89-39"></a>                          <span class="st">"VX"</span> <span class="ot">=</span> <span class="st">"Virgin America"</span>,</span>
<span id="cb89-40"><a href="#cb89-40"></a>                          <span class="st">"WN"</span> <span class="ot">=</span> <span class="st">"Southwest Airlines"</span>,</span>
<span id="cb89-41"><a href="#cb89-41"></a>                          <span class="st">"YV"</span> <span class="ot">=</span> <span class="st">"Mesa Airlines"</span>),</span>
<span id="cb89-42"><a href="#cb89-42"></a>         <span class="at">.after =</span> carrier) </span>
<span id="cb89-43"><a href="#cb89-43"></a></span>
<span id="cb89-44"><a href="#cb89-44"></a>flights_new </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 24
    year quarter month   day dep_time sched_dep_time dep_delay arr_time
   &lt;int&gt; &lt;chr&gt;   &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
 1  2013 Winter      1     1      517            515         2      830
 2  2013 Winter      1     1      533            529         4      850
 3  2013 Winter      1     1      542            540         2      923
 4  2013 Winter      1     1      544            545        -1     1004
 5  2013 Winter      1     1      554            600        -6      812
 6  2013 Winter      1     1      554            558        -4      740
 7  2013 Winter      1     1      555            600        -5      913
 8  2013 Winter      1     1      557            600        -3      709
 9  2013 Winter      1     1      557            600        -3      838
10  2013 Winter      1     1      558            600        -2      753
# ℹ 336,766 more rows
# ℹ 16 more variables: sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, status &lt;chr&gt;,
#   gain &lt;dbl&gt;, speed &lt;dbl&gt;, carrier &lt;chr&gt;, company &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
</section>
<section id="groups" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="groups"><span class="header-section-number">3.6</span> Groups</h2>
<section id="group_by" class="level3" data-number="3.6.1">
<h3 data-number="3.6.1" class="anchored" data-anchor-id="group_by"><span class="header-section-number">3.6.1</span> group_by()</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb91-2"><a href="#cb91-2"></a>  <span class="fu">group_by</span>(month) <span class="co">#按照month分组</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 19
# Groups:   month [12]
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      517            515         2      830            819
 2  2013     1     1      533            529         4      850            830
 3  2013     1     1      542            540         2      923            850
 4  2013     1     1      544            545        -1     1004           1022
 5  2013     1     1      554            600        -6      812            837
 6  2013     1     1      554            558        -4      740            728
 7  2013     1     1      555            600        -5      913            854
 8  2013     1     1      557            600        -3      709            723
 9  2013     1     1      557            600        -3      838            846
10  2013     1     1      558            600        -2      753            745
# ℹ 336,766 more rows
# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
<p>group_by() 不会改变数据，但输出显示它是按”月份”分组的。这意味着随后的操作现在将”按月”进行。group_by() 为数据框添加了这个分组特征，这改变了随后应用于数据的动作。</p>
</section>
<section id="summarize" class="level3" data-number="3.6.2">
<h3 data-number="3.6.2" class="anchored" data-anchor-id="summarize"><span class="header-section-number">3.6.2</span> summarize()</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb93-2"><a href="#cb93-2"></a>  <span class="fu">group_by</span>(month) <span class="sc">%&gt;%</span> </span>
<span id="cb93-3"><a href="#cb93-3"></a>  <span class="fu">summarise</span>(<span class="at">mean_delay =</span> <span class="fu">mean</span>(dep_delay)) <span class="co">#按照month分组，计算dep_delay的均值</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 2
   month mean_delay
   &lt;int&gt;      &lt;dbl&gt;
 1     1         NA
 2     2         NA
 3     3         NA
 4     4         NA
 5     5         NA
 6     6         NA
 7     7         NA
 8     8         NA
 9     9         NA
10    10         NA
11    11         NA
12    12         NA</code></pre>
</div>
</div>
<p>NA: missing value</p>
<p>当向量中有NA，mean()函数默认返回NA，如果想忽略NA值，可以使用na.rm = TRUE</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb95-2"><a href="#cb95-2"></a>  <span class="fu">group_by</span>(month) <span class="sc">%&gt;%</span> </span>
<span id="cb95-3"><a href="#cb95-3"></a>  <span class="fu">summarise</span>(<span class="at">mean_delay =</span> <span class="fu">mean</span>(dep_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="co">#na.rm = TRUE表示忽略NA值</span></span>
<span id="cb95-4"><a href="#cb95-4"></a>            <span class="at">n =</span> <span class="fu">n</span>()</span>
<span id="cb95-5"><a href="#cb95-5"></a>  ) <span class="co">#按照month分组，计算dep_delay的均值和n</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 3
   month mean_delay     n
   &lt;int&gt;      &lt;dbl&gt; &lt;int&gt;
 1     1      10.0  27004
 2     2      10.8  24951
 3     3      13.2  28834
 4     4      13.9  28330
 5     5      13.0  28796
 6     6      20.8  28243
 7     7      21.7  29425
 8     8      12.6  29327
 9     9       6.72 27574
10    10       6.24 28889
11    11       5.44 27268
12    12      16.6  28135</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1"></a><span class="co"># 统计每天的航班数量</span></span>
<span id="cb97-2"><a href="#cb97-2"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb97-3"><a href="#cb97-3"></a>  <span class="fu">group_by</span>(year, month, day) <span class="sc">%&gt;%</span> </span>
<span id="cb97-4"><a href="#cb97-4"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="co">#生成的数据框是一个有分组结构的数据框</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'year', 'month'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 365 × 4
# Groups:   year, month [12]
    year month   day     n
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
 1  2013     1     1   842
 2  2013     1     2   943
 3  2013     1     3   914
 4  2013     1     4   915
 5  2013     1     5   720
 6  2013     1     6   832
 7  2013     1     7   933
 8  2013     1     8   899
 9  2013     1     9   902
10  2013     1    10   932
# ℹ 355 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb100-2"><a href="#cb100-2"></a>  <span class="fu">group_by</span>(year, month, day) <span class="sc">%&gt;%</span> </span>
<span id="cb100-3"><a href="#cb100-3"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(),           <span class="co">#按照year, month, day分组，计算n</span></span>
<span id="cb100-4"><a href="#cb100-4"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>   <span class="co">#生成的数据框是没有分组结构</span></span>
<span id="cb100-5"><a href="#cb100-5"></a>            ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 365 × 4
    year month   day     n
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
 1  2013     1     1   842
 2  2013     1     2   943
 3  2013     1     3   914
 4  2013     1     4   915
 5  2013     1     5   720
 6  2013     1     6   832
 7  2013     1     7   933
 8  2013     1     8   899
 9  2013     1     9   902
10  2013     1    10   932
# ℹ 355 more rows</code></pre>
</div>
</div>
</section>
<section id="by" class="level3" data-number="3.6.3">
<h3 data-number="3.6.3" class="anchored" data-anchor-id="by"><span class="header-section-number">3.6.3</span> .by</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb102-2"><a href="#cb102-2"></a>  <span class="fu">summarize</span>(<span class="at">mean_delay =</span> <span class="fu">mean</span>(dep_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>),</span>
<span id="cb102-3"><a href="#cb102-3"></a>            <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb102-4"><a href="#cb102-4"></a>            <span class="at">.by =</span> month </span>
<span id="cb102-5"><a href="#cb102-5"></a>  ) <span class="sc">%&gt;%</span> <span class="co">#按月份分组，计算dep_delay的均值和n</span></span>
<span id="cb102-6"><a href="#cb102-6"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_delay)) <span class="co">#按mean_delay降序</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 3
   month mean_delay     n
   &lt;int&gt;      &lt;dbl&gt; &lt;int&gt;
 1     7      21.7  29425
 2     6      20.8  28243
 3    12      16.6  28135
 4     4      13.9  28330
 5     3      13.2  28834
 6     5      13.0  28796
 7     8      12.6  29327
 8     2      10.8  24951
 9     1      10.0  27004
10     9       6.72 27574
11    10       6.24 28889
12    11       5.44 27268</code></pre>
</div>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb104-2"><a href="#cb104-2"></a>  <span class="fu">summarize</span>(<span class="at">mean_delay =</span> <span class="fu">mean</span>(dep_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>),</span>
<span id="cb104-3"><a href="#cb104-3"></a>            <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb104-4"><a href="#cb104-4"></a>            <span class="at">.by =</span> <span class="fu">c</span>(origin)  <span class="co">#按origin分组，计算dep_delay的均值和n</span></span>
<span id="cb104-5"><a href="#cb104-5"></a>            ) <span class="sc">%&gt;%</span> </span>
<span id="cb104-6"><a href="#cb104-6"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_delay)) <span class="co">#按mean_delay降序</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  origin mean_delay      n
  &lt;chr&gt;       &lt;dbl&gt;  &lt;int&gt;
1 EWR          15.1 120835
2 JFK          12.1 111279
3 LGA          10.3 104662</code></pre>
</div>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb106-2"><a href="#cb106-2"></a>  <span class="fu">summarize</span>(<span class="at">mean_delay =</span> <span class="fu">mean</span>(dep_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)<span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>),</span>
<span id="cb106-3"><a href="#cb106-3"></a>            <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb106-4"><a href="#cb106-4"></a>            <span class="at">.by =</span> <span class="fu">c</span>(dest) <span class="co">#按dest分组，计算dep_delay的均值和n</span></span>
<span id="cb106-5"><a href="#cb106-5"></a>            ) <span class="sc">%&gt;%</span></span>
<span id="cb106-6"><a href="#cb106-6"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_delay)) <span class="co">#按mean_delay降序</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 105 × 3
   dest  mean_delay     n
   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;
 1 CAE         35.6   116
 2 TUL         34.9   315
 3 OKC         30.6   346
 4 BHM         29.7   297
 5 TYS         28.5   631
 6 JAC         26.5    25
 7 DSM         26.2   569
 8 RIC         23.6  2454
 9 ALB         23.6   439
10 MSN         23.6   572
# ℹ 95 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb108-2"><a href="#cb108-2"></a>  <span class="fu">summarize</span>(<span class="at">mean_delay =</span> <span class="fu">mean</span>(dep_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)<span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>),</span>
<span id="cb108-3"><a href="#cb108-3"></a>            <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb108-4"><a href="#cb108-4"></a>            <span class="at">.by =</span> <span class="fu">c</span>(origin, dest) <span class="co">#按origin, dest分组，计算dep_delay的均值和n</span></span>
<span id="cb108-5"><a href="#cb108-5"></a>            ) <span class="sc">%&gt;%</span></span>
<span id="cb108-6"><a href="#cb108-6"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_delay)) <span class="co">#按mean_delay降序</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 224 × 4
   origin dest  mean_delay     n
   &lt;chr&gt;  &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;
 1 EWR    TYS         41.8   323
 2 EWR    CAE         36.3   104
 3 EWR    TUL         34.9   315
 4 LGA    SBN         31.3     6
 5 EWR    OKC         30.6   346
 6 LGA    BHM         29.8   296
 7 LGA    CAE         29.5    12
 8 EWR    DSM         29.3   411
 9 EWR    JAC         28.7    23
10 EWR    ROC         27.9   513
# ℹ 214 more rows</code></pre>
</div>
</div>
</section>
<section id="小练习-2" class="level3" data-number="3.6.4">
<h3 data-number="3.6.4" class="anchored" data-anchor-id="小练习-2"><span class="header-section-number">3.6.4</span> 小练习</h3>
<p>第1题：如果你想尽可能避免延误，你应该选择哪个时间段起飞的航班？</p>
<p>第2题：哪三家航空公司(carrier)的平均延误时间(arr_delay)最长？</p>
<p>第3题：哪个月份的平均延误时间(arr_delay)最长？</p>
<p>第4题：将延误时间(arr_delay)超过15分钟的定义为延误航班。 计算各个月份的延误航班的比例，并按比例降序排列。</p>
<p>第5题：将延误时间(arr_delay)超过15分钟的定义为延误航班。 计算各个航空公司(carrier)的延误航班的比例，并按各航空公司航班数量降序排列。</p>
<p>第6题：从JFK机场出发(origin)的航班中，航班数量最多的5家航空公司是哪些？并统计出其航班数量？</p>
<details>
<summary>
code
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1"></a><span class="co"># 第1题</span></span>
<span id="cb110-2"><a href="#cb110-2"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb110-3"><a href="#cb110-3"></a>  <span class="fu">group_by</span>(hour) <span class="sc">%&gt;%</span></span>
<span id="cb110-4"><a href="#cb110-4"></a>  <span class="fu">summarise</span>(<span class="at">avg_arr_delay =</span> <span class="fu">mean</span>(arr_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb110-5"><a href="#cb110-5"></a>  <span class="fu">arrange</span>(avg_arr_delay) <span class="sc">%&gt;%</span> </span>
<span id="cb110-6"><a href="#cb110-6"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="cn">Inf</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 2
    hour avg_arr_delay
   &lt;dbl&gt;         &lt;dbl&gt;
 1     7        -5.30 
 2     5        -4.80 
 3     6        -3.38 
 4     9        -1.45 
 5     8        -1.11 
 6    10         0.954
 7    11         1.48 
 8    12         3.49 
 9    13         6.54 
10    14         9.20 
11    23        11.8  
12    15        12.3  
13    16        12.6  
14    18        14.8  
15    22        16.0  
16    17        16.0  
17    19        16.7  
18    20        16.7  
19    21        18.4  
20     1       NaN    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1"></a><span class="co"># 第2题</span></span>
<span id="cb112-2"><a href="#cb112-2"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb112-3"><a href="#cb112-3"></a>  <span class="fu">group_by</span>(carrier) <span class="sc">%&gt;%</span></span>
<span id="cb112-4"><a href="#cb112-4"></a>  <span class="fu">summarise</span>(<span class="at">avg_arr_delay =</span> <span class="fu">mean</span>(arr_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb112-5"><a href="#cb112-5"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(avg_arr_delay)) <span class="sc">%&gt;%</span></span>
<span id="cb112-6"><a href="#cb112-6"></a>  <span class="fu">top_n</span>(<span class="dv">3</span>, avg_arr_delay)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  carrier avg_arr_delay
  &lt;chr&gt;           &lt;dbl&gt;
1 F9               21.9
2 FL               20.1
3 EV               15.8</code></pre>
</div>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1"></a><span class="co"># 第3题</span></span>
<span id="cb114-2"><a href="#cb114-2"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb114-3"><a href="#cb114-3"></a>  <span class="fu">group_by</span>(month) <span class="sc">%&gt;%</span></span>
<span id="cb114-4"><a href="#cb114-4"></a>  <span class="fu">summarise</span>(<span class="at">avg_arr_delay =</span> <span class="fu">mean</span>(arr_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb114-5"><a href="#cb114-5"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(avg_arr_delay)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 2
   month avg_arr_delay
   &lt;int&gt;         &lt;dbl&gt;
 1     7        16.7  
 2     6        16.5  
 3    12        14.9  
 4     4        11.2  
 5     1         6.13 
 6     8         6.04 
 7     3         5.81 
 8     2         5.61 
 9     5         3.52 
10    11         0.461
11    10        -0.167
12     9        -4.02 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1"></a><span class="co"># 第4题</span></span>
<span id="cb116-2"><a href="#cb116-2"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb116-3"><a href="#cb116-3"></a>  <span class="fu">mutate</span>(<span class="at">is_delayed =</span> arr_delay <span class="sc">&gt;</span> <span class="dv">15</span>) <span class="sc">%&gt;%</span></span>
<span id="cb116-4"><a href="#cb116-4"></a>  <span class="fu">group_by</span>(month) <span class="sc">%&gt;%</span></span>
<span id="cb116-5"><a href="#cb116-5"></a>  <span class="fu">summarise</span>(</span>
<span id="cb116-6"><a href="#cb116-6"></a>    <span class="at">total_flights =</span> <span class="fu">n</span>(),</span>
<span id="cb116-7"><a href="#cb116-7"></a>    <span class="at">delayed_flights =</span> <span class="fu">sum</span>(is_delayed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb116-8"><a href="#cb116-8"></a>    <span class="at">delay_proportion =</span> delayed_flights <span class="sc">/</span> total_flights</span>
<span id="cb116-9"><a href="#cb116-9"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb116-10"><a href="#cb116-10"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(delay_proportion)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 4
   month total_flights delayed_flights delay_proportion
   &lt;int&gt;         &lt;int&gt;           &lt;int&gt;            &lt;dbl&gt;
 1    12         28135            8812            0.313
 2     7         29425            8902            0.303
 3     6         28243            8340            0.295
 4     4         28330            7700            0.272
 5     8         29327            6852            0.234
 6     1         27004            6001            0.222
 7     3         28834            6374            0.221
 8     2         24951            5418            0.217
 9     5         28796            6178            0.215
10    11         27268            4680            0.172
11    10         28889            4798            0.166
12     9         27574            3575            0.130</code></pre>
</div>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1"></a><span class="co"># 第5题</span></span>
<span id="cb118-2"><a href="#cb118-2"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb118-3"><a href="#cb118-3"></a>  <span class="fu">mutate</span>(<span class="at">is_delayed =</span> arr_delay <span class="sc">&gt;</span> <span class="dv">15</span>) <span class="sc">%&gt;%</span></span>
<span id="cb118-4"><a href="#cb118-4"></a>  <span class="fu">group_by</span>(carrier) <span class="sc">%&gt;%</span></span>
<span id="cb118-5"><a href="#cb118-5"></a>  <span class="fu">summarise</span>(</span>
<span id="cb118-6"><a href="#cb118-6"></a>    <span class="at">total_flights =</span> <span class="fu">n</span>(),</span>
<span id="cb118-7"><a href="#cb118-7"></a>    <span class="at">delayed_flights =</span> <span class="fu">sum</span>(is_delayed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb118-8"><a href="#cb118-8"></a>    <span class="at">delay_proportion =</span> delayed_flights <span class="sc">/</span> total_flights</span>
<span id="cb118-9"><a href="#cb118-9"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb118-10"><a href="#cb118-10"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(total_flights)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 4
   carrier total_flights delayed_flights delay_proportion
   &lt;chr&gt;           &lt;int&gt;           &lt;int&gt;            &lt;dbl&gt;
 1 UA              58665           12592            0.215
 2 B6              54635           14111            0.258
 3 EV              54173           16028            0.296
 4 DL              48110            8690            0.181
 5 AA              32729            6004            0.183
 6 MQ              26397            6777            0.257
 7 US              20536            3559            0.173
 8 9E              18460            4309            0.233
 9 WN              12275            2994            0.244
10 VX               5162             924            0.179
11 FL               3260            1065            0.327
12 AS                714             102            0.143
13 F9                685             254            0.371
14 YV                601             171            0.285
15 HA                342              43            0.126
16 OO                 32               7            0.219</code></pre>
</div>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1"></a><span class="co"># 第6题</span></span>
<span id="cb120-2"><a href="#cb120-2"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb120-3"><a href="#cb120-3"></a>  <span class="fu">filter</span>(origin <span class="sc">==</span> <span class="st">"JFK"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb120-4"><a href="#cb120-4"></a>  <span class="fu">group_by</span>(carrier) <span class="sc">%&gt;%</span></span>
<span id="cb120-5"><a href="#cb120-5"></a>  <span class="fu">summarise</span>(<span class="at">number_of_flights =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb120-6"><a href="#cb120-6"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(number_of_flights)) <span class="sc">%&gt;%</span></span>
<span id="cb120-7"><a href="#cb120-7"></a>  <span class="fu">top_n</span>(<span class="dv">5</span>, number_of_flights) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 2
  carrier number_of_flights
  &lt;chr&gt;               &lt;int&gt;
1 B6                  42076
2 DL                  20701
3 9E                  14651
4 AA                  13783
5 MQ                   7193</code></pre>
</div>
</div>
</details></section>
</section>
</section>
<section id="forcats函数" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> forcats函数</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb122-2"><a href="#cb122-2"></a><span class="fu">data</span>(mpg)</span>
<span id="cb122-3"><a href="#cb122-3"></a></span>
<span id="cb122-4"><a href="#cb122-4"></a><span class="fu">count</span>(mpg, drv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  drv       n
  &lt;chr&gt; &lt;int&gt;
1 4       103
2 f       106
3 r        25</code></pre>
</div>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1"></a>mpg <span class="sc">%&gt;%</span> </span>
<span id="cb124-2"><a href="#cb124-2"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(drv, <span class="at">fill =</span> drv)) <span class="sc">+</span></span>
<span id="cb124-3"><a href="#cb124-3"></a>  <span class="fu">geom_bar</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="script5_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="fct_recode" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="fct_recode"><span class="header-section-number">4.1</span> fct_recode()</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1"></a>mpg <span class="ot">&lt;-</span> mpg <span class="sc">%&gt;%</span></span>
<span id="cb125-2"><a href="#cb125-2"></a>  <span class="fu">mutate</span>(<span class="at">drv =</span> <span class="fu">fct_recode</span>(drv,</span>
<span id="cb125-3"><a href="#cb125-3"></a>                          <span class="st">"front wheels"</span> <span class="ot">=</span> <span class="st">"f"</span>,</span>
<span id="cb125-4"><a href="#cb125-4"></a>                          <span class="st">"rear wheels"</span> <span class="ot">=</span> <span class="st">"r"</span>,</span>
<span id="cb125-5"><a href="#cb125-5"></a>                          <span class="st">"four wheels"</span> <span class="ot">=</span> <span class="st">"4"</span>))</span>
<span id="cb125-6"><a href="#cb125-6"></a></span>
<span id="cb125-7"><a href="#cb125-7"></a>mpg <span class="sc">%&gt;%</span> </span>
<span id="cb125-8"><a href="#cb125-8"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(drv, <span class="at">fill =</span> drv)) <span class="sc">+</span></span>
<span id="cb125-9"><a href="#cb125-9"></a>  <span class="fu">geom_bar</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="script5_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="fct_infreq-按频数降序" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="fct_infreq-按频数降序"><span class="header-section-number">4.2</span> fct_infreq() 按频数降序</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1"></a>mpg <span class="sc">%&gt;%</span> </span>
<span id="cb126-2"><a href="#cb126-2"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="fu">fct_infreq</span>(drv), <span class="at">fill =</span> drv)) <span class="sc">+</span></span>
<span id="cb126-3"><a href="#cb126-3"></a>  <span class="fu">geom_bar</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="script5_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="fct_rev" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="fct_rev"><span class="header-section-number">4.3</span> fct_rev()</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1"></a>mpg <span class="sc">%&gt;%</span> </span>
<span id="cb127-2"><a href="#cb127-2"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="fu">fct_rev</span>(<span class="fu">fct_infreq</span>(drv)), <span class="at">fill =</span> drv)) <span class="sc">+</span></span>
<span id="cb127-3"><a href="#cb127-3"></a>  <span class="fu">geom_bar</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="script5_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="fct_reorder" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="fct_reorder"><span class="header-section-number">4.4</span> fct_reorder()</h2>
<section id="按中位数升序排列箱线图" class="level3" data-number="4.4.1">
<h3 data-number="4.4.1" class="anchored" data-anchor-id="按中位数升序排列箱线图"><span class="header-section-number">4.4.1</span> 按中位数升序排列箱线图</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1"></a>mpg <span class="sc">%&gt;%</span></span>
<span id="cb128-2"><a href="#cb128-2"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(cty, <span class="fu">fct_reorder</span>(class, cty),</span>
<span id="cb128-3"><a href="#cb128-3"></a>             <span class="at">fill =</span> class)) <span class="sc">+</span></span>
<span id="cb128-4"><a href="#cb128-4"></a>  <span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="script5_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="按中位数降序排列箱线图" class="level3" data-number="4.4.2">
<h3 data-number="4.4.2" class="anchored" data-anchor-id="按中位数降序排列箱线图"><span class="header-section-number">4.4.2</span> 按中位数降序排列箱线图</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1"></a>mpg <span class="sc">%&gt;%</span></span>
<span id="cb129-2"><a href="#cb129-2"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(cty, <span class="fu">fct_reorder</span>(class, <span class="sc">-</span>cty),</span>
<span id="cb129-3"><a href="#cb129-3"></a>             <span class="at">fill =</span> class)) <span class="sc">+</span></span>
<span id="cb129-4"><a href="#cb129-4"></a>  <span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="script5_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="按平均数排列箱线图" class="level3" data-number="4.4.3">
<h3 data-number="4.4.3" class="anchored" data-anchor-id="按平均数排列箱线图"><span class="header-section-number">4.4.3</span> 按平均数排列箱线图</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1"></a>mpg <span class="sc">%&gt;%</span> </span>
<span id="cb130-2"><a href="#cb130-2"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="fu">fct_reorder</span>(class, cty, <span class="at">.fun =</span> mean), </span>
<span id="cb130-3"><a href="#cb130-3"></a>             cty, <span class="at">fill =</span> class)) <span class="sc">+</span></span>
<span id="cb130-4"><a href="#cb130-4"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb130-5"><a href="#cb130-5"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Class"</span>, <span class="at">x =</span> <span class="st">"Class"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="script5_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="柱形的排列" class="level3" data-number="4.4.4">
<h3 data-number="4.4.4" class="anchored" data-anchor-id="柱形的排列"><span class="header-section-number">4.4.4</span> 柱形的排列</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1"></a>mpg <span class="sc">%&gt;%</span> </span>
<span id="cb131-2"><a href="#cb131-2"></a>  <span class="fu">group_by</span>(drv) <span class="sc">%&gt;%</span></span>
<span id="cb131-3"><a href="#cb131-3"></a>  <span class="fu">summarise</span>(<span class="at">mean_cty =</span> <span class="fu">mean</span>(cty)) <span class="sc">%&gt;%</span> </span>
<span id="cb131-4"><a href="#cb131-4"></a>  <span class="fu">mutate</span>(<span class="at">drv =</span> <span class="fu">fct_reorder</span>(drv, mean_cty)) <span class="sc">%&gt;%</span></span>
<span id="cb131-5"><a href="#cb131-5"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(drv, mean_cty, <span class="at">fill =</span> drv)) <span class="sc">+</span></span>
<span id="cb131-6"><a href="#cb131-6"></a>  <span class="fu">geom_col</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="script5_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1"></a>mpg <span class="sc">%&gt;%</span> </span>
<span id="cb132-2"><a href="#cb132-2"></a>  <span class="fu">group_by</span>(drv) <span class="sc">%&gt;%</span></span>
<span id="cb132-3"><a href="#cb132-3"></a>  <span class="fu">summarise</span>(<span class="at">mean_cty =</span> <span class="fu">mean</span>(cty)) <span class="sc">%&gt;%</span> </span>
<span id="cb132-4"><a href="#cb132-4"></a>  <span class="fu">mutate</span>(<span class="at">drv =</span> <span class="fu">fct_reorder</span>(drv, <span class="sc">-</span>mean_cty)) <span class="sc">%&gt;%</span></span>
<span id="cb132-5"><a href="#cb132-5"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(drv, mean_cty, <span class="at">fill =</span> drv)) <span class="sc">+</span></span>
<span id="cb132-6"><a href="#cb132-6"></a>  <span class="fu">geom_col</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="script5_files/figure-html/unnamed-chunk-39-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="fct_lump_合并小类" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="fct_lump_合并小类"><span class="header-section-number">4.5</span> fct_lump_()合并小类</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb133-2"><a href="#cb133-2"></a><span class="fu">data</span>(mpg)</span>
<span id="cb133-3"><a href="#cb133-3"></a></span>
<span id="cb133-4"><a href="#cb133-4"></a><span class="fu">count</span>(mpg, class) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 2
  class          n
  &lt;chr&gt;      &lt;int&gt;
1 suv           62
2 compact       47
3 midsize       41
4 subcompact    35
5 pickup        33
6 minivan       11
7 2seater        5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1"></a><span class="fu">fct_lump_n</span>(mpg<span class="sc">$</span>class, <span class="dv">4</span>) <span class="sc">%&gt;%</span> <span class="fu">fct_count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 2
  f              n
  &lt;fct&gt;      &lt;int&gt;
1 compact       47
2 midsize       41
3 subcompact    35
4 suv           62
5 Other         49</code></pre>
</div>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1"></a><span class="fu">fct_lump_min</span>(mpg<span class="sc">$</span>class, <span class="dv">30</span>) <span class="sc">%&gt;%</span> <span class="fu">fct_count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  f              n
  &lt;fct&gt;      &lt;int&gt;
1 compact       47
2 midsize       41
3 pickup        33
4 subcompact    35
5 suv           62
6 Other         16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1"></a><span class="fu">fct_lump_lowfreq</span>(mpg<span class="sc">$</span>class) <span class="sc">%&gt;%</span> <span class="fu">fct_count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  f              n
  &lt;fct&gt;      &lt;int&gt;
1 compact       47
2 midsize       41
3 pickup        33
4 subcompact    35
5 suv           62
6 Other         16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1"></a><span class="fu">fct_lump_prop</span>(mpg<span class="sc">$</span>class, <span class="fl">0.14</span>) <span class="sc">%&gt;%</span> <span class="fu">fct_count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  f              n
  &lt;fct&gt;      &lt;int&gt;
1 compact       47
2 midsize       41
3 pickup        33
4 subcompact    35
5 suv           62
6 Other         16</code></pre>
</div>
</div>
</section>
<section id="fct_collaps保留指定类别" class="level2" data-number="4.6">
<h2 data-number="4.6" class="anchored" data-anchor-id="fct_collaps保留指定类别"><span class="header-section-number">4.6</span> fct_collaps()保留指定类别</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1"></a>mpg <span class="sc">%&gt;%</span></span>
<span id="cb143-2"><a href="#cb143-2"></a>  <span class="fu">group_by</span>(class) <span class="sc">%&gt;%</span></span>
<span id="cb143-3"><a href="#cb143-3"></a>  <span class="fu">summarise</span>(<span class="at">proportion =</span> <span class="fu">n</span>() <span class="sc">/</span> <span class="fu">nrow</span>(mpg)) <span class="sc">%&gt;%</span></span>
<span id="cb143-4"><a href="#cb143-4"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(proportion))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 2
  class      proportion
  &lt;chr&gt;           &lt;dbl&gt;
1 suv            0.265 
2 compact        0.201 
3 midsize        0.175 
4 subcompact     0.150 
5 pickup         0.141 
6 minivan        0.0470
7 2seater        0.0214</code></pre>
</div>
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1"></a><span class="fu">fct_collapse</span>(mpg<span class="sc">$</span>class,</span>
<span id="cb145-2"><a href="#cb145-2"></a>             <span class="st">"compact"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"compact"</span>, <span class="st">"subcompact"</span>),</span>
<span id="cb145-3"><a href="#cb145-3"></a>             <span class="st">"midsize"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"midsize"</span>, <span class="st">"minivan"</span>, <span class="st">"pickup"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb145-4"><a href="#cb145-4"></a>  <span class="fu">fct_count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
  f           n
  &lt;fct&gt;   &lt;int&gt;
1 2seater     5
2 compact    82
3 midsize    85
4 suv        62</code></pre>
</div>
</div>
</section>
<section id="fct_other" class="level2" data-number="4.7">
<h2 data-number="4.7" class="anchored" data-anchor-id="fct_other"><span class="header-section-number">4.7</span> fct_other()</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1"></a><span class="co"># c: CNG (Compressed Natural Gas)</span></span>
<span id="cb147-2"><a href="#cb147-2"></a><span class="co"># d: Diesel</span></span>
<span id="cb147-3"><a href="#cb147-3"></a><span class="co"># e: Ethanol blend, typically referring to gasoline blended with a certain proportion of ethanol</span></span>
<span id="cb147-4"><a href="#cb147-4"></a><span class="co"># p: Premium unleaded gasoline 辛烷值较高，通常在91到93之间（在美国），有的甚至更高</span></span>
<span id="cb147-5"><a href="#cb147-5"></a><span class="co"># r: Regular unleaded gasoline 辛烷值较低，通常是87（在美国）</span></span>
<span id="cb147-6"><a href="#cb147-6"></a></span>
<span id="cb147-7"><a href="#cb147-7"></a>mpg <span class="sc">%&gt;%</span> </span>
<span id="cb147-8"><a href="#cb147-8"></a>  <span class="fu">count</span>(fl) <span class="sc">%&gt;%</span> </span>
<span id="cb147-9"><a href="#cb147-9"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 2
  fl        n
  &lt;chr&gt; &lt;int&gt;
1 r       168
2 p        52
3 e         8
4 d         5
5 c         1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1"></a><span class="fu">fct_other</span>(mpg<span class="sc">$</span>fl, <span class="at">keep =</span> <span class="fu">c</span>(<span class="st">"p"</span>, <span class="st">"r"</span>)) <span class="sc">%&gt;%</span> <span class="fu">fct_count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  f         n
  &lt;fct&gt; &lt;int&gt;
1 p        52
2 r       168
3 Other    14</code></pre>
</div>
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1"></a><span class="fu">fct_other</span>(mpg<span class="sc">$</span>fl, <span class="at">drop =</span> <span class="fu">c</span>(<span class="st">"c"</span>, <span class="st">"d"</span>, <span class="st">"e"</span>)) <span class="sc">%&gt;%</span> <span class="fu">fct_count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  f         n
  &lt;fct&gt; &lt;int&gt;
1 p        52
2 r       168
3 Other    14</code></pre>
</div>
</div>
</section>
<section id="保存合并后的类别" class="level2" data-number="4.8">
<h2 data-number="4.8" class="anchored" data-anchor-id="保存合并后的类别"><span class="header-section-number">4.8</span> 保存合并后的类别</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1"></a><span class="co"># 保存合并后的类别</span></span>
<span id="cb153-2"><a href="#cb153-2"></a></span>
<span id="cb153-3"><a href="#cb153-3"></a>mpg <span class="ot">&lt;-</span> mpg <span class="sc">%&gt;%</span> </span>
<span id="cb153-4"><a href="#cb153-4"></a>  <span class="fu">mutate</span>(<span class="at">fl =</span> <span class="fu">fct_other</span>(fl, <span class="at">keep =</span> <span class="fu">c</span>(<span class="st">"p"</span>, <span class="st">"r"</span>)),</span>
<span id="cb153-5"><a href="#cb153-5"></a>         <span class="at">class =</span> <span class="fu">fct_collapse</span>(class,</span>
<span id="cb153-6"><a href="#cb153-6"></a>                               <span class="st">"compact"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"compact"</span>, <span class="st">"subcompact"</span>),</span>
<span id="cb153-7"><a href="#cb153-7"></a>                               <span class="st">"midsize"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"midsize"</span>, <span class="st">"minivan"</span>, <span class="st">"pickup"</span>))</span>
<span id="cb153-8"><a href="#cb153-8"></a>         )</span>
<span id="cb153-9"><a href="#cb153-9"></a></span>
<span id="cb153-10"><a href="#cb153-10"></a>mpg <span class="sc">%&gt;%</span> <span class="fu">count</span>(fl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  fl        n
  &lt;fct&gt; &lt;int&gt;
1 p        52
2 r       168
3 Other    14</code></pre>
</div>
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1"></a>mpg <span class="sc">%&gt;%</span> <span class="fu">count</span>(class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
  class       n
  &lt;fct&gt;   &lt;int&gt;
1 2seater     5
2 compact    82
3 midsize    85
4 suv        62</code></pre>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© Copyright 2025, Li Zongzhang</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>Statistics: turning data into insights.</p>
</div>
  </div>
</footer>




</body></html>